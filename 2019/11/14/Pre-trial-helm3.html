<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.0.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png">
  <link rel="mask-icon" href="/images/safari-pinned-tab.svg" color="#222">
  <link rel="manifest" href="/images/site.webmanifest">
  <meta name="msapplication-config" content="/images/browserconfig.xml">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic|consolas:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">
<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">


<script id="hexo-configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '7.5.0',
    exturl: false,
    sidebar: {"position":"left","display":"post","offset":12,"onmobile":false},
    copycode: {"enable":true,"show_result":true,"style":"mac"},
    back2top: {"enable":true,"sidebar":false,"scrollpercent":true},
    bookmark: {"enable":true,"color":"#222","save":"auto"},
    fancybox: false,
    mediumzoom: false,
    lazyload: false,
    pangu: false,
    algolia: {
      appID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    localsearch: {"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},
    path: '',
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    translation: {
      copy_button: '复制',
      copy_success: '复制成功',
      copy_failure: '复制失败'
    },
    sidebarPadding: 40
  };
</script>

  <meta name="description" content="Helm3 今天stable了，所以今天先抢先试用一下Helm3。官网： https:&#x2F;&#x2F;helm.sh&#x2F; GitHub： https:&#x2F;&#x2F;github.com&#x2F;helm&#x2F;helm Docs： https:&#x2F;&#x2F;helm.sh&#x2F;docs [toc]相对于Helm2，Helm3的改进如下： 移除了Tiller组件，Helm的权限通过 kubeconfig文件 来确定； 改进了upgrade升级策略；">
<meta name="keywords" content="helm">
<meta property="og:type" content="article">
<meta property="og:title" content="抢先试用Helm3，并安装nginx-ingress-controller">
<meta property="og:url" content="https:&#x2F;&#x2F;knner.wang&#x2F;2019&#x2F;11&#x2F;14&#x2F;Pre-trial-helm3.html">
<meta property="og:site_name" content="Knner.Wang&#39;s Blog">
<meta property="og:description" content="Helm3 今天stable了，所以今天先抢先试用一下Helm3。官网： https:&#x2F;&#x2F;helm.sh&#x2F; GitHub： https:&#x2F;&#x2F;github.com&#x2F;helm&#x2F;helm Docs： https:&#x2F;&#x2F;helm.sh&#x2F;docs [toc]相对于Helm2，Helm3的改进如下： 移除了Tiller组件，Helm的权限通过 kubeconfig文件 来确定； 改进了upgrade升级策略；">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="https:&#x2F;&#x2F;imgs.knner.wang&#x2F;images&#x2F;logos&#x2F;helm-logo-small.jpg">
<meta property="og:image" content="https:&#x2F;&#x2F;imgs.knner.wang&#x2F;images&#x2F;knner&#x2F;wx.jpg">
<meta property="og:updated_time" content="2019-11-14T06:16:28.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https:&#x2F;&#x2F;imgs.knner.wang&#x2F;images&#x2F;logos&#x2F;helm-logo-small.jpg">

<link rel="canonical" href="https://knner.wang/2019/11/14/Pre-trial-helm3.html">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: false,
    isPost: true,
    isPage: false,
    isArchive: false
  };
</script>

  <title>抢先试用Helm3，并安装nginx-ingress-controller | Knner.Wang's Blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-meta">

    <div>
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Knner.Wang's Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
  </div>

  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>首页</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i>标签<span class="badge">20</span></a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>归档<span class="badge">25</span></a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i>关于</a>

  </li>
  </ul>

</nav>
</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>
  <a role="button" class="book-mark-link book-mark-link-fixed"></a>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content">
            

  <div class="posts-expand">
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block " lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://knner.wang/2019/11/14/Pre-trial-helm3.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="Knner.Wang">
      <meta itemprop="description" content="Knner.Wang's Blog,for sharing IT technology and also my study notes.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Knner.Wang's Blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          抢先试用Helm3，并安装nginx-ingress-controller
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-11-14 14:16:28" itemprop="dateCreated datePublished" datetime="2019-11-14T14:16:28+08:00">2019-11-14</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/kubernetes/" itemprop="url" rel="index">
                    <span itemprop="name">kubernetes</span>
                  </a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/kubernetes/helm/" itemprop="url" rel="index">
                    <span itemprop="name">helm</span>
                  </a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
      <span class="post-meta-item-text">Disqus：</span>
    
    <a title="disqus" href="/2019/11/14/Pre-trial-helm3.html#comments" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2019/11/14/Pre-trial-helm3.html" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>Helm3 今天stable了，所以今天先抢先试用一下Helm3。</p><p><img src="https://imgs.knner.wang/images/logos/helm-logo-small.jpg" alt="Helm"></p><p>官网：</p><p> <a href="https://helm.sh/" target="_blank" rel="noopener">https://helm.sh/</a> </p><p>GitHub：</p><p> <a href="https://github.com/helm/helm" target="_blank" rel="noopener">https://github.com/helm/helm</a> </p><p>Docs：</p><p> <a href="https://helm.sh/docs" target="_blank" rel="noopener">https://helm.sh/docs</a> </p><p>[toc]</p><p>相对于Helm2，Helm3的改进如下：</p><ul>
<li>移除了Tiller组件，Helm的权限通过 <a href="https://kubernetes.io/docs/concepts/configuration/organize-cluster-access-kubeconfig/" target="_blank" rel="noopener">kubeconfig文件</a> 来确定；</li>
<li>改进了upgrade升级策略；</li>
<li>Helm2 中release的默认被安装到了Tiller所在的namespace，在Helm3中默认是Context中指定的名称空间；</li>
<li>Helm2 将数据信息存储在了Configmap上，Helm3中存储在了Secret上；</li>
<li>如果指定安装到新的namespace上，Helm3默认自动创建这个不存在的namespace；</li>
<li>local or stable repositories默认已经被移除；</li>
<li>迁移Helm2 –&gt; Helm3，请参考：<a href="https://github.com/helm/helm-2to3" target="_blank" rel="noopener">官方</a>，<a href="https://helm.sh/blog/migrate-from-helm-v2-to-helm-v3/" target="_blank" rel="noopener">Blog</a>，<a href="https://github.com/helm/helm-2to3" target="_blank" rel="noopener">GitHub</a></li>
<li>其他详尽的变化请参考<a href="https://helm.sh/docs/faq/#changes-since-helm-2" target="_blank" rel="noopener">官方</a>；</li>
</ul><a id="more"></a>










<h2 id="前提依赖"><a href="#前提依赖" class="headerlink" title="前提依赖"></a>前提依赖</h2><p>快速搭建一套测试的Kubernetes环境，请参考：</p>
<a href="/2019/11/12/Quick-install-kubernetes-1-15-5-for-test.html" title="使用kubeadm快速安装kubernetes 1.15.5测试环境">使用kubeadm快速安装kubernetes 1.15.5测试环境</a>



<h2 id="安装Helm3"><a href="#安装Helm3" class="headerlink" title="安装Helm3"></a>安装Helm3</h2><p>首先从GitHub Release下载最新版的Helm3：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 下载</span></span><br><span class="line">$ wget -c <span class="string">"https://get.helm.sh/helm-v3.0.0-linux-amd64.tar.gz"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装很简单，只需要将helm移动到 $PATH 即可</span></span><br><span class="line">$ tar xf helm-v3.0.0-linux-amd64.tar.gz</span><br><span class="line">$ sudo mv linux-amd64/helm /usr/<span class="built_in">local</span>/bin/</span><br></pre></td></tr></table></figure>

<p>安装完成，测试一下：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ helm version</span><br><span class="line">version.BuildInfo&#123;Version:<span class="string">"v3.0.0"</span>, GitCommit:<span class="string">"e29ce2a54e96cd02ccfce88bee4f58bb6e2a28b6"</span>, GitTreeState:<span class="string">"clean"</span>, GoVersion:<span class="string">"go1.13.4"</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看一下帮助：</span></span><br><span class="line">$ helm --<span class="built_in">help</span></span><br><span class="line">The Kubernetes package manager</span><br><span class="line"></span><br><span class="line">Common actions <span class="keyword">for</span> Helm:</span><br><span class="line"></span><br><span class="line">- helm search:    search <span class="keyword">for</span> charts</span><br><span class="line">- helm pull:      download a chart to your <span class="built_in">local</span> directory to view</span><br><span class="line">- helm install:   upload the chart to Kubernetes</span><br><span class="line">- helm list:      list releases of charts</span><br><span class="line"></span><br><span class="line">Environment variables: <span class="comment"># 这里列出了有用的环境变量</span></span><br><span class="line"></span><br><span class="line">+------------------+-----------------------------------------------------------------------------+</span><br><span class="line">| Name             | Description                                                                 |</span><br><span class="line">+------------------+-----------------------------------------------------------------------------+</span><br><span class="line">| <span class="variable">$XDG_CACHE_HOME</span>  | <span class="built_in">set</span> an alternative location <span class="keyword">for</span> storing cached files.                       |</span><br><span class="line">| <span class="variable">$XDG_CONFIG_HOME</span> | <span class="built_in">set</span> an alternative location <span class="keyword">for</span> storing Helm configuration.                 |</span><br><span class="line">| <span class="variable">$XDG_DATA_HOME</span>   | <span class="built_in">set</span> an alternative location <span class="keyword">for</span> storing Helm data.                          |</span><br><span class="line">| <span class="variable">$HELM_DRIVER</span>     | <span class="built_in">set</span> the backend storage driver. Values are: configmap, secret, memory       |</span><br><span class="line">| <span class="variable">$HELM_NO_PLUGINS</span> | <span class="built_in">disable</span> plugins. Set HELM_NO_PLUGINS=1 to <span class="built_in">disable</span> plugins.                  |</span><br><span class="line">| <span class="variable">$KUBECONFIG</span>      | <span class="built_in">set</span> an alternative Kubernetes configuration file (default <span class="string">"~/.kube/config"</span>) |</span><br><span class="line">+------------------+-----------------------------------------------------------------------------+</span><br><span class="line"></span><br><span class="line">Helm stores configuration based on the XDG base directory specification, so</span><br><span class="line"></span><br><span class="line">- cached files are stored <span class="keyword">in</span> <span class="variable">$XDG_CACHE_HOME</span>/helm</span><br><span class="line">- configuration is stored <span class="keyword">in</span> <span class="variable">$XDG_CONFIG_HOME</span>/helm</span><br><span class="line">- data is stored <span class="keyword">in</span> <span class="variable">$XDG_DATA_HOME</span>/helm</span><br><span class="line"></span><br><span class="line"><span class="comment"># 这里列出了有用的存储目录</span></span><br><span class="line">By default, the default directories depend on the Operating System. The defaults are listed below:</span><br><span class="line"></span><br><span class="line">+------------------+---------------------------+--------------------------------+-------------------------+</span><br><span class="line">| Operating System | Cache Path                | Configuration Path             | Data Path               |</span><br><span class="line">+------------------+---------------------------+--------------------------------+-------------------------+</span><br><span class="line">| Linux            | <span class="variable">$HOME</span>/.cache/helm         | <span class="variable">$HOME</span>/.config/helm             | <span class="variable">$HOME</span>/.<span class="built_in">local</span>/share/helm |</span><br><span class="line">| macOS            | <span class="variable">$HOME</span>/Library/Caches/helm | <span class="variable">$HOME</span>/Library/Preferences/helm | <span class="variable">$HOME</span>/Library/helm      |</span><br><span class="line">| Windows          | %TEMP%\helm               | %APPDATA%\helm                 | %APPDATA%\helm          |</span><br><span class="line">+------------------+---------------------------+--------------------------------+-------------------------+</span><br><span class="line"></span><br><span class="line">Usage:</span><br><span class="line">  helm [<span class="built_in">command</span>]</span><br><span class="line"></span><br><span class="line">Available Commands:</span><br><span class="line">  completion  Generate autocompletions script <span class="keyword">for</span> the specified shell (bash or zsh) <span class="comment"># 命令自动补全</span></span><br><span class="line">  create      create a new chart with the given name <span class="comment"># 创建chart</span></span><br><span class="line">  dependency  manage a chart<span class="string">'s dependencies # 管理chart依赖</span></span><br><span class="line"><span class="string">  env         Helm client environment information # 列出helm 环境</span></span><br><span class="line"><span class="string">  get         download extended information of a named release # 获取release的额外信息</span></span><br><span class="line"><span class="string">  help        Help about any command</span></span><br><span class="line"><span class="string">  history     fetch release history # 获取历史release</span></span><br><span class="line"><span class="string">  install     install a chart # 安装chart</span></span><br><span class="line"><span class="string">  lint        examines a chart for possible issues # 检查chart是否有问题</span></span><br><span class="line"><span class="string">  list        list releases # 列出release</span></span><br><span class="line"><span class="string">  package     package a chart directory into a chart archive # 打包一个chart目录</span></span><br><span class="line"><span class="string">  plugin      install, list, or uninstall Helm plugins # helm plugin 插件子命令</span></span><br><span class="line"><span class="string">  pull        download a chart from a repository and (optionally) unpack it in local directory # 从chart仓库下载chart，并解压到当前目录</span></span><br><span class="line"><span class="string">  repo        add, list, remove, update, and index chart repositories # helm repo 子命令</span></span><br><span class="line"><span class="string">  rollback    roll back a release to a previous revision # 回滚一个release</span></span><br><span class="line"><span class="string">  search      search for a keyword in charts # 搜索chart</span></span><br><span class="line"><span class="string">  show        show information of a chart # 查看chart的信息</span></span><br><span class="line"><span class="string">  status      displays the status of the named release # 查看release的状态</span></span><br><span class="line"><span class="string">  template    locally render templates  # helm 模板</span></span><br><span class="line"><span class="string">  test        run tests for a release # 测试一个release</span></span><br><span class="line"><span class="string">  uninstall   uninstall a release # 卸载release</span></span><br><span class="line"><span class="string">  upgrade     upgrade a release # 升级release</span></span><br><span class="line"><span class="string">  verify      verify that a chart at the given path has been signed and is valid # 验证chart</span></span><br><span class="line"><span class="string">  version     print the client version information</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Flags:</span></span><br><span class="line"><span class="string">      --add-dir-header                   If true, adds the file directory to the header</span></span><br><span class="line"><span class="string">      --alsologtostderr                  log to standard error as well as files</span></span><br><span class="line"><span class="string">      --debug                            enable verbose output</span></span><br><span class="line"><span class="string">  -h, --help                             help for helm</span></span><br><span class="line"><span class="string">      --kube-context string              name of the kubeconfig context to use</span></span><br><span class="line"><span class="string">      --kubeconfig string                path to the kubeconfig file</span></span><br><span class="line"><span class="string">      --log-backtrace-at traceLocation   when logging hits line file:N, emit a stack trace (default :0)</span></span><br><span class="line"><span class="string">      --log-dir string                   If non-empty, write log files in this directory</span></span><br><span class="line"><span class="string">      --log-file string                  If non-empty, use this log file</span></span><br><span class="line"><span class="string">      --log-file-max-size uint           Defines the maximum size a log file can grow to. Unit is megabytes. If the value is 0, the maximum file size is unlimited. (default 1800)</span></span><br><span class="line"><span class="string">      --logtostderr                      log to standard error instead of files (default true)</span></span><br><span class="line"><span class="string">  -n, --namespace string                 namespace scope for this request</span></span><br><span class="line"><span class="string">      --registry-config string           path to the registry config file (default "/home/microoak/.config/helm/registry.json")</span></span><br><span class="line"><span class="string">      --repository-cache string          path to the file containing cached repository indexes (default "/home/microoak/.cache/helm/repository")</span></span><br><span class="line"><span class="string">      --repository-config string         path to the file containing repository names and URLs (default "/home/microoak/.config/helm/repositories.yaml")</span></span><br><span class="line"><span class="string">      --skip-headers                     If true, avoid header prefixes in the log messages</span></span><br><span class="line"><span class="string">      --skip-log-headers                 If true, avoid headers when opening log files</span></span><br><span class="line"><span class="string">      --stderrthreshold severity         logs at or above this threshold go to stderr (default 2)</span></span><br><span class="line"><span class="string">  -v, --v Level                          number for the log level verbosity</span></span><br><span class="line"><span class="string">      --vmodule moduleSpec               comma-separated list of pattern=N settings for file-filtered logging</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Use "helm [command] --help" for more information about a command.</span></span><br></pre></td></tr></table></figure>

<div class="note info">
            <p>什么是chart，什么是release，什么是repository呢？</p><p>chart，类似于一个yaml文件，当然他是多个yaml的集合，还没有被安装到kubernetes集群中的包。可以认为它是一个服务的安装包。</p><p>release，就是已经被安装到kubernetes集群中的了，可以认为它是一个服务吧。</p><p>repository，就是一个专门存放chart的仓库，类似于yum源，apt源等</p>
          </div>

<div class="note info">
            <p>来自官方的解释：三个组件，<a href="https://helm.sh/docs/intro/using_helm/#three-big-concepts" target="_blank" rel="noopener">参考</a></p><p>A <em>Chart</em> is a Helm package. It contains all of the resource definitions necessary to run an application, tool, or service inside of a Kubernetes cluster. Think of it like the Kubernetes equivalent of a Homebrew formula, an Apt dpkg, or a Yum RPM file.</p><p>A <em>Repository</em> is the place where charts can be collected and shared. It’s like Perl’s <a href="https://www.cpan.org/" target="_blank" rel="noopener">CPAN archive</a> or the <a href="https://admin.fedoraproject.org/pkgdb/" target="_blank" rel="noopener">Fedora Package Database</a>, but for Kubernetes packages.</p><p>A <em>Release</em> is an instance of a chart running in a Kubernetes cluster. One chart can often be installed many times into the same cluster. And each time it is installed, a new <em>release</em> is created. Consider a MySQL chart. If you want two databases running in your cluster, you can install that chart twice. Each one will have its own <em>release</em>, which will in turn have its own <em>release name</em>.</p><p>With these concepts in mind, we can now explain Helm like this:</p><p>Helm installs <em>charts</em> into Kubernetes, creating a new <em>release</em> for each installation. And to find new charts, you can search Helm chart <em>repositories</em>.</p><p>Helm 专业术语：请<a href="https://helm.sh/docs/glossary/" target="_blank" rel="noopener">参考</a></p>
          </div>



<p>使用Helm，参考<a href="https://helm.sh/docs/intro/using_helm/" target="_blank" rel="noopener">Using Helm</a></p>
<h3 id="配置helm的自动补全"><a href="#配置helm的自动补全" class="headerlink" title="配置helm的自动补全"></a>配置helm的自动补全</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 这里只是给当前用户配置的，如果要给所有用户配置，则插入到/etc/profile即可。</span></span><br><span class="line">$ cat &gt;&gt; ~/.bashrc &lt;&lt;EOF</span><br><span class="line"><span class="built_in">source</span> &lt;(helm completion bash)</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line"><span class="comment"># 应用</span></span><br><span class="line">$ <span class="built_in">source</span> ~/.bashrc</span><br><span class="line"></span><br><span class="line"><span class="comment"># 测试</span></span><br><span class="line">$ helm &lt;tab键&gt;</span><br><span class="line">completion  dependency  get         install     list        plugin      repo        search      status      <span class="built_in">test</span>        upgrade     version</span><br><span class="line">create      env         <span class="built_in">history</span>     lint        package     pull        rollback    show        template    uninstall   verify</span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果报错，需要安装：bash-completion</span></span><br><span class="line">$ sudo yum install bash-completion -y</span><br></pre></td></tr></table></figure>



<h3 id="查看默认helm的环境变量"><a href="#查看默认helm的环境变量" class="headerlink" title="查看默认helm的环境变量"></a>查看默认helm的环境变量</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ helm env</span><br><span class="line">HELM_DEBUG=<span class="string">"false"</span> <span class="comment"># 是否开启debug</span></span><br><span class="line">HELM_PLUGINS=<span class="string">"/home/user/.local/share/helm/plugins"</span> <span class="comment"># 插件目录</span></span><br><span class="line">HELM_REGISTRY_CONFIG=<span class="string">"/home/user/.config/helm/registry.json"</span> <span class="comment"># registry仓库配置文件</span></span><br><span class="line">HELM_REPOSITORY_CACHE=<span class="string">"/home/user/.cache/helm/repository"</span> <span class="comment"># repo仓库缓存目录</span></span><br><span class="line">HELM_REPOSITORY_CONFIG=<span class="string">"/home/user/.config/helm/repositories.yaml"</span> <span class="comment"># repo配置文件</span></span><br><span class="line">HELM_NAMESPACE=<span class="string">"default"</span> <span class="comment"># 默认使用的kubernetes命名空间是default</span></span><br><span class="line">HELM_KUBECONTEXT=<span class="string">""</span> <span class="comment"># 默认使用的kubernetes context，~/.kube/config 中配置的</span></span><br><span class="line">HELM_BIN=<span class="string">"helm"</span></span><br></pre></td></tr></table></figure>



<h3 id="查看配置helm-repo"><a href="#查看配置helm-repo" class="headerlink" title="查看配置helm repo"></a>查看配置helm repo</h3><p>首先查看一下repo子命令帮助：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ helm repo</span><br><span class="line"></span><br><span class="line">This <span class="built_in">command</span> consists of multiple subcommands to interact with chart repositories.</span><br><span class="line"></span><br><span class="line">It can be used to add, remove, list, and index chart repositories.</span><br><span class="line"></span><br><span class="line">Usage:</span><br><span class="line">  helm repo [<span class="built_in">command</span>]</span><br><span class="line"></span><br><span class="line">Available Commands:</span><br><span class="line">  add         add a chart repository</span><br><span class="line">  index       generate an index file given a directory containing packaged charts</span><br><span class="line">  list        list chart repositories</span><br><span class="line">  remove      remove a chart repository</span><br><span class="line">  update      update information of available charts locally from chart repositories</span><br></pre></td></tr></table></figure>

<p>查看默认的repo：helm2 初始化完是有一个默认的stable的存放在google的repo的，helm3则完全需要自己配置repo。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ helm repo list</span><br><span class="line">Error: no repositories to show</span><br></pre></td></tr></table></figure>

<p>安装一个Helm repo：参考：<a href="https://helm.sh/docs/intro/quickstart/" target="_blank" rel="noopener">QuickStart</a></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 官方的repo，存放在google，需要FQ</span></span><br><span class="line">$ helm repo add stable https://kubernetes-charts.storage.googleapis.com/</span><br><span class="line"></span><br><span class="line"><span class="comment"># 这里使用Azure中国区镜像源</span></span><br><span class="line">$ helm repo add stable http://mirror.azure.cn/kubernetes/charts</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看一下repo的配置文件吧，还记得在哪里吧？helm env查看一下就知道了：</span></span><br><span class="line">$ cat .config/helm/repositories.yaml</span><br><span class="line">apiVersion: <span class="string">""</span></span><br><span class="line">generated: <span class="string">"0001-01-01T00:00:00Z"</span></span><br><span class="line">repositories:</span><br><span class="line">- caFile: <span class="string">""</span></span><br><span class="line">  certFile: <span class="string">""</span></span><br><span class="line">  keyFile: <span class="string">""</span></span><br><span class="line">  name: stable</span><br><span class="line">  password: <span class="string">""</span></span><br><span class="line">  url: http://mirror.azure.cn/kubernetes/charts</span><br><span class="line">  username: <span class="string">""</span></span><br></pre></td></tr></table></figure>

<p>类似于ubuntu的apt源，用之前需要update一下：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ helm repo list</span><br><span class="line">NAME  	URL                                     </span><br><span class="line">stable	http://mirror.azure.cn/kubernetes/charts</span><br><span class="line"></span><br><span class="line">$ helm repo update </span><br><span class="line">Hang tight <span class="keyword">while</span> we grab the latest from your chart repositories...</span><br><span class="line">...Successfully got an update from the <span class="string">"stable"</span> chart repository</span><br><span class="line">Update Complete. ⎈ Happy Helming!⎈</span><br></pre></td></tr></table></figure>

<p>现在OK了，之前快速安装Kubernetes 1.15了：<a href="/2019/11/12/Quick-install-kubernetes-1-15-5-for-test.html" title="使用kubeadm快速安装kubernetes 1.15.5测试环境">使用kubeadm快速安装kubernetes 1.15.5测试环境</a></p>
<p>接着安装一个nginx ingress吧，方便后续使用。</p>
<h2 id="使用Helm3-安装nginx-ingress"><a href="#使用Helm3-安装nginx-ingress" class="headerlink" title="使用Helm3 安装nginx-ingress"></a>使用Helm3 安装nginx-ingress</h2><p>因为nginx-ingress有很多的参数需要定义，先下载chart，修改后再安装：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 先查找一下，看一下search子命令帮助：</span></span><br><span class="line">$ helm search --<span class="built_in">help</span></span><br><span class="line"></span><br><span class="line">Search provides the ability to search <span class="keyword">for</span> Helm charts <span class="keyword">in</span> the various places</span><br><span class="line">they can be stored including the Helm Hub and repositories you have added. Use</span><br><span class="line">search subcommands to search different locations <span class="keyword">for</span> charts.</span><br><span class="line"></span><br><span class="line">Usage:</span><br><span class="line">  helm search [<span class="built_in">command</span>]</span><br><span class="line"></span><br><span class="line">Available Commands:</span><br><span class="line">  hub         search <span class="keyword">for</span> charts <span class="keyword">in</span> the Helm Hub or an instance of Monocular <span class="comment"># 这里多了个Helm Hub</span></span><br><span class="line">  repo        search repositories <span class="keyword">for</span> a keyword <span class="keyword">in</span> charts <span class="comment"># 这是以前的概念</span></span><br><span class="line">  </span><br><span class="line"><span class="comment"># 查找nginx-ingress</span></span><br><span class="line">$ helm search repo nginx-ingress</span><br><span class="line">NAME                	CHART VERSION	APP VERSION	DESCRIPTION                                       </span><br><span class="line">stable/nginx-ingress	1.24.7       	0.26.1     	An nginx Ingress controller that uses ConfigMap...</span><br><span class="line">stable/nginx-lego   	0.3.1        	           	Chart <span class="keyword">for</span> nginx-ingress-controller and kube-lego</span><br><span class="line"></span><br><span class="line"><span class="comment"># 下载stable/nginx-ingress</span></span><br><span class="line">$ helm pull stable/nginx-ingress</span><br><span class="line">$ ll</span><br><span class="line">nginx-ingress-1.24.7.tgz</span><br><span class="line">$ tar xf nginx-ingress-1.24.7.tgz</span><br></pre></td></tr></table></figure>

<div class="note info">
            <p>Helm Hub 是Helm官方的repo，地址是： <a href="https://hub.helm.sh/" target="_blank" rel="noopener">https://hub.helm.sh/</a> 。</p><p>Repo 可以是用户自己搭建的repo。</p>
          </div>

<p>配置nginx-ingress chart：</p>
<p>首先备份一下values.yaml，免得改的太多，改错了。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> nginx-ingress/</span><br><span class="line">$ cp values.yaml&#123;,.ori&#125;</span><br></pre></td></tr></table></figure>

<p>更改values.yaml文件如下：</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ngxin ingress controller 配置：</span></span><br><span class="line"><span class="attr">controller:</span></span><br><span class="line">  <span class="attr">image:</span></span><br><span class="line">    <span class="attr">repository:</span> <span class="string">quay.azk8s.cn/kubernetes-ingress-controller/nginx-ingress-controller</span></span><br><span class="line">  <span class="attr">hostNetwork:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">daemonset:</span></span><br><span class="line">    <span class="attr">useHostPort:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">kind:</span> <span class="string">DaemonSet</span></span><br><span class="line">  <span class="attr">minReadySeconds:</span> <span class="number">5</span></span><br><span class="line">  <span class="attr">updateStrategy:</span> </span><br><span class="line">    <span class="attr">rollingUpdate:</span></span><br><span class="line">      <span class="attr">maxUnavailable:</span> <span class="number">1</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">RollingUpdate</span></span><br><span class="line">  <span class="attr">tolerations:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">operator:</span> <span class="string">"Exists"</span></span><br><span class="line">  <span class="attr">nodeSelector:</span></span><br><span class="line">    <span class="attr">canruningress:</span> <span class="string">run</span></span><br><span class="line">  <span class="attr">resources:</span> </span><br><span class="line">    <span class="attr">limits:</span></span><br><span class="line">      <span class="attr">cpu:</span> <span class="string">100m</span></span><br><span class="line">      <span class="attr">memory:</span> <span class="string">256Mi</span></span><br><span class="line">    <span class="attr">requests:</span></span><br><span class="line">      <span class="attr">cpu:</span> <span class="string">100m</span></span><br><span class="line">      <span class="attr">memory:</span> <span class="string">128Mi</span></span><br><span class="line">  <span class="attr">service:</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">ClusterIP</span></span><br><span class="line">  <span class="attr">metrics:</span></span><br><span class="line">    <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 默认后端配置</span></span><br><span class="line"><span class="attr">defaultBackend:</span></span><br><span class="line">  <span class="attr">image:</span></span><br><span class="line">    <span class="attr">repository:</span> <span class="string">gcr.azk8s.cn/google-containers/defaultbackend-amd64</span></span><br><span class="line">  <span class="attr">resources:</span> </span><br><span class="line">   <span class="attr">limits:</span></span><br><span class="line">     <span class="attr">cpu:</span> <span class="string">10m</span></span><br><span class="line">     <span class="attr">memory:</span> <span class="string">20Mi</span></span><br><span class="line">   <span class="attr">requests:</span></span><br><span class="line">     <span class="attr">cpu:</span> <span class="string">10m</span></span><br><span class="line">     <span class="attr">memory:</span> <span class="string">20Mi</span></span><br></pre></td></tr></table></figure>

<div class="note sucess">
            <p>配置说明：</p><ol><li><p>使用azure中国区源代替默认的quay，gcr.azk8s.cn中国区无法拉取的源，参考：<a href="/2019/11/13/docker-io-gcr-io-k8s-gcr-io-quay-io-Chinese-source.html" title="docker.io gcr.io k8s.gcr.io quay.io 中国区源">docker.io gcr.io k8s.gcr.io quay.io 中国区源</a></p></li><li><p>我这里使用了daemonset方式只在master主机上安装，并且使用了hostNetwork。</p></li></ol><div class="note danger">            <p>生产上建议单独加入多台cpu核数多的主机当worker节点，并设置上污点；</p><p>nginx-ingress 使用主机网络，以daemonset的方式跑在这几个worker节点中，然后上层在使用LB，给这几个nginx-ingress创建单独高可用的入口。</p>          </div><ol start="3"><li>建议将所有的pod都设置上允许的资源量，以免将来pod资源请求不受控制，同时建议配置上prometheus+grafana方便观察pod占用量大小，根据这些数据再修改分配的资源，已达到运行pod所需资源量，但又不浪费的临界点。</li></ol>
          </div>

<p>上面的配置：设定了nodeSelector，我这里就在master节点打上对应的标签，让nginx-ingress跑在master节点上。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ kubectl get node</span><br><span class="line">NAME                  STATUS   ROLES    AGE   VERSION</span><br><span class="line">k8s01.test.awsbj.cn   Ready    master   26h   v1.15.5</span><br><span class="line">k8s02.test.awsbj.cn   Ready    &lt;none&gt;   26h   v1.15.5</span><br><span class="line">k8s03.test.awsbj.cn   Ready    &lt;none&gt;   26h   v1.15.5</span><br><span class="line"></span><br><span class="line">$ kubectl label nodes k8s01.test.awsbj.cn canruningress=run</span><br><span class="line">node/k8s01.test.awsbj.cn labeled</span><br><span class="line"></span><br><span class="line">$ kubectl get node --show-labels </span><br><span class="line">NAME                  STATUS   ROLES    AGE   VERSION   LABELS</span><br><span class="line">k8s01.test.awsbj.cn   Ready    master   26h   v1.15.5   beta.kubernetes.io/arch=amd64,beta.kubernetes.io/os=linux,canruningress=run,kubernetes.io/arch=amd64,kubernetes.io/hostname=k8s01.test.awsbj.cn,kubernetes.io/os=linux,node-role.kubernetes.io/master=</span><br><span class="line">k8s02.test.awsbj.cn   Ready    &lt;none&gt;   26h   v1.15.5   beta.kubernetes.io/arch=amd64,beta.kubernetes.io/os=linux,kubernetes.io/arch=amd64,kubernetes.io/hostname=k8s02.test.awsbj.cn,kubernetes.io/os=linux</span><br><span class="line">k8s03.test.awsbj.cn   Ready    &lt;none&gt;   26h   v1.15.5   beta.kubernetes.io/arch=amd64,beta.kubernetes.io/os=linux,kubernetes.io/arch=amd64,kubernetes.io/hostname=k8s03.test.awsbj.cn,kubernetes.io/os=linux</span><br></pre></td></tr></table></figure>

<p>安装nginx-ingress：</p>
<p>还一样，先查看对应命名的帮助：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ helm install --<span class="built_in">help</span></span><br><span class="line"></span><br><span class="line">This <span class="built_in">command</span> installs a chart archive.</span><br><span class="line"></span><br><span class="line">The install argument must be a chart reference, a path to a packaged chart,</span><br><span class="line">a path to an unpacked chart directory or a URL.</span><br><span class="line"></span><br><span class="line">To override values <span class="keyword">in</span> a chart, use either the <span class="string">'--values'</span> flag and pass <span class="keyword">in</span> a file</span><br><span class="line">or use the <span class="string">'--set'</span> flag and pass configuration from the <span class="built_in">command</span> line, to force</span><br><span class="line">a string value use <span class="string">'--set-string'</span>. In <span class="keyword">case</span> a value is large and therefore</span><br><span class="line">you want not to use neither <span class="string">'--values'</span> nor <span class="string">'--set'</span>, use <span class="string">'--set-file'</span> to <span class="built_in">read</span> the</span><br><span class="line">single large value from file.</span><br><span class="line"></span><br><span class="line">    $ helm install -f myvalues.yaml myredis ./redis</span><br><span class="line"></span><br><span class="line">or</span><br><span class="line"></span><br><span class="line">    $ helm install --<span class="built_in">set</span> name=prod myredis ./redis</span><br><span class="line"></span><br><span class="line">or</span><br><span class="line"></span><br><span class="line">    $ helm install --<span class="built_in">set</span>-string long_int=1234567890 myredis ./redis</span><br><span class="line"></span><br><span class="line">or</span><br><span class="line">    $ helm install --<span class="built_in">set</span>-file my_script=dothings.sh myredis ./redis</span><br><span class="line"></span><br><span class="line">You can specify the <span class="string">'--values'</span>/<span class="string">'-f'</span> flag multiple <span class="built_in">times</span>. The priority will be given to the</span><br><span class="line">last (right-most) file specified. For example, <span class="keyword">if</span> both myvalues.yaml and override.yaml</span><br><span class="line">contained a key called <span class="string">'Test'</span>, the value <span class="built_in">set</span> <span class="keyword">in</span> override.yaml would take precedence:</span><br><span class="line"></span><br><span class="line">    $ helm install -f myvalues.yaml -f override.yaml  myredis ./redis</span><br><span class="line"></span><br><span class="line">You can specify the <span class="string">'--set'</span> flag multiple <span class="built_in">times</span>. The priority will be given to the</span><br><span class="line">last (right-most) <span class="built_in">set</span> specified. For example, <span class="keyword">if</span> both <span class="string">'bar'</span> and <span class="string">'newbar'</span> values are</span><br><span class="line"><span class="built_in">set</span> <span class="keyword">for</span> a key called <span class="string">'foo'</span>, the <span class="string">'newbar'</span> value would take precedence:</span><br><span class="line"></span><br><span class="line">    $ helm install --<span class="built_in">set</span> foo=bar --<span class="built_in">set</span> foo=newbar  myredis ./redis</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">To check the generated manifests of a release without installing the chart,</span><br><span class="line">the <span class="string">'--debug'</span> and <span class="string">'--dry-run'</span> flags can be combined.</span><br><span class="line"></span><br><span class="line">If --verify is <span class="built_in">set</span>, the chart MUST have a provenance file, and the provenance</span><br><span class="line">file MUST pass all verification steps.</span><br><span class="line"></span><br><span class="line">There are five different ways you can express the chart you want to install:</span><br><span class="line"></span><br><span class="line">1. By chart reference: helm install mymaria example/mariadb</span><br><span class="line">2. By path to a packaged chart: helm install mynginx ./nginx-1.2.3.tgz</span><br><span class="line">3. By path to an unpacked chart directory: helm install mynginx ./nginx</span><br><span class="line">4. By absolute URL: helm install mynginx https://example.com/charts/nginx-1.2.3.tgz</span><br><span class="line">5. By chart reference and repo url: helm install --repo https://example.com/charts/ mynginx nginx</span><br><span class="line"></span><br><span class="line">CHART REFERENCES</span><br><span class="line"></span><br><span class="line">A chart reference is a convenient way of referencing a chart <span class="keyword">in</span> a chart repository.</span><br><span class="line"></span><br><span class="line">When you use a chart reference with a repo prefix (<span class="string">'example/mariadb'</span>), Helm will look <span class="keyword">in</span> the <span class="built_in">local</span></span><br><span class="line">configuration <span class="keyword">for</span> a chart repository named <span class="string">'example'</span>, and will <span class="keyword">then</span> look <span class="keyword">for</span> a</span><br><span class="line">chart <span class="keyword">in</span> that repository whose name is <span class="string">'mariadb'</span>. It will install the latest stable version of that chart</span><br><span class="line">until you specify <span class="string">'--devel'</span> flag to also include development version (alpha, beta, and release candidate releases), or</span><br><span class="line">supply a version number with the <span class="string">'--version'</span> flag.</span><br><span class="line"></span><br><span class="line">To see the list of chart repositories, use <span class="string">'helm repo list'</span>. To search <span class="keyword">for</span></span><br><span class="line">charts <span class="keyword">in</span> a repository, use <span class="string">'helm search'</span>.</span><br><span class="line"></span><br><span class="line">Usage: <span class="comment"># 命令格式</span></span><br><span class="line">  helm install [NAME] [CHART] [flags]</span><br><span class="line"></span><br><span class="line">Flags:</span><br><span class="line">      --atomic                   <span class="keyword">if</span> <span class="built_in">set</span>, installation process purges chart on fail. The --<span class="built_in">wait</span> flag will be <span class="built_in">set</span> automatically <span class="keyword">if</span> --atomic is used</span><br><span class="line">      --ca-file string           verify certificates of HTTPS-enabled servers using this CA bundle</span><br><span class="line">      --cert-file string         identify HTTPS client using this SSL certificate file</span><br><span class="line">      --dependency-update        run helm dependency update before installing the chart</span><br><span class="line">      --devel                    use development versions, too. Equivalent to version <span class="string">'&gt;0.0.0-0'</span>. If --version is <span class="built_in">set</span>, this is ignored</span><br><span class="line">      --dry-run                  simulate an install</span><br><span class="line">  -g, --generate-name            generate the name (and omit the NAME parameter)</span><br><span class="line">  -h, --<span class="built_in">help</span>                     <span class="built_in">help</span> <span class="keyword">for</span> install</span><br><span class="line">      --key-file string          identify HTTPS client using this SSL key file</span><br><span class="line">      --keyring string           location of public keys used <span class="keyword">for</span> verification (default <span class="string">"/home/microoak/.gnupg/pubring.gpg"</span>)</span><br><span class="line">      --name-template string     specify template used to name the release</span><br><span class="line">      --no-hooks                 prevent hooks from running during install</span><br><span class="line">  -o, --output format            prints the output <span class="keyword">in</span> the specified format. Allowed values: table, json, yaml (default table)</span><br><span class="line">      --password string          chart repository password <span class="built_in">where</span> to locate the requested chart</span><br><span class="line">      --render-subchart-notes    <span class="keyword">if</span> <span class="built_in">set</span>, render subchart notes along with the parent</span><br><span class="line">      --replace                  re-use the given name, even <span class="keyword">if</span> that name is already used. This is unsafe <span class="keyword">in</span> production</span><br><span class="line">      --repo string              chart repository url <span class="built_in">where</span> to locate the requested chart</span><br><span class="line">      --<span class="built_in">set</span> stringArray          <span class="built_in">set</span> values on the <span class="built_in">command</span> line (can specify multiple or separate values with commas: key1=val1,key2=val2)</span><br><span class="line">      --<span class="built_in">set</span>-file stringArray     <span class="built_in">set</span> values from respective files specified via the <span class="built_in">command</span> line (can specify multiple or separate values with commas: key1=path1,key2=path2)</span><br><span class="line">      --<span class="built_in">set</span>-string stringArray   <span class="built_in">set</span> STRING values on the <span class="built_in">command</span> line (can specify multiple or separate values with commas: key1=val1,key2=val2)</span><br><span class="line">      --skip-crds                <span class="keyword">if</span> <span class="built_in">set</span>, no CRDs will be installed. By default, CRDs are installed <span class="keyword">if</span> not already present</span><br><span class="line">      --timeout duration         time to <span class="built_in">wait</span> <span class="keyword">for</span> any individual Kubernetes operation (like Jobs <span class="keyword">for</span> hooks) (default 5m0s)</span><br><span class="line">      --username string          chart repository username <span class="built_in">where</span> to locate the requested chart</span><br><span class="line">  -f, --values strings           specify values <span class="keyword">in</span> a YAML file or a URL(can specify multiple)</span><br><span class="line">      --verify                   verify the package before installing it</span><br><span class="line">      --version string           specify the exact chart version to install. If this is not specified, the latest version is installed</span><br><span class="line">      --<span class="built_in">wait</span>                     <span class="keyword">if</span> <span class="built_in">set</span>, will <span class="built_in">wait</span> until all Pods, PVCs, Services, and minimum number of Pods of a Deployment, StatefulSet, or ReplicaSet are <span class="keyword">in</span> a ready state before marking the release as successful. It will <span class="built_in">wait</span> <span class="keyword">for</span> as long as --timeout</span><br><span class="line"></span><br><span class="line">Global Flags:</span><br><span class="line">      --add-dir-header                   If <span class="literal">true</span>, adds the file directory to the header</span><br><span class="line">      --alsologtostderr                  <span class="built_in">log</span> to standard error as well as files</span><br><span class="line">      --debug                            <span class="built_in">enable</span> verbose output</span><br><span class="line">      --kube-context string              name of the kubeconfig context to use</span><br><span class="line">      --kubeconfig string                path to the kubeconfig file</span><br><span class="line">      --<span class="built_in">log</span>-backtrace-at traceLocation   when logging hits line file:N, emit a stack trace (default :0)</span><br><span class="line">      --<span class="built_in">log</span>-dir string                   If non-empty, write <span class="built_in">log</span> files <span class="keyword">in</span> this directory</span><br><span class="line">      --<span class="built_in">log</span>-file string                  If non-empty, use this <span class="built_in">log</span> file</span><br><span class="line">      --<span class="built_in">log</span>-file-max-size uint           Defines the maximum size a <span class="built_in">log</span> file can grow to. Unit is megabytes. If the value is 0, the maximum file size is unlimited. (default 1800)</span><br><span class="line">      --logtostderr                      <span class="built_in">log</span> to standard error instead of files (default <span class="literal">true</span>)</span><br><span class="line">  -n, --namespace string                 namespace scope <span class="keyword">for</span> this request</span><br><span class="line">      --registry-config string           path to the registry config file (default <span class="string">"/home/microoak/.config/helm/registry.json"</span>)</span><br><span class="line">      --repository-cache string          path to the file containing cached repository indexes (default <span class="string">"/home/microoak/.cache/helm/repository"</span>)</span><br><span class="line">      --repository-config string         path to the file containing repository names and URLs (default <span class="string">"/home/microoak/.config/helm/repositories.yaml"</span>)</span><br><span class="line">      --skip-headers                     If <span class="literal">true</span>, avoid header prefixes <span class="keyword">in</span> the <span class="built_in">log</span> messages</span><br><span class="line">      --skip-log-headers                 If <span class="literal">true</span>, avoid headers when opening <span class="built_in">log</span> files</span><br><span class="line">      --stderrthreshold severity         logs at or above this threshold go to stderr (default 2)</span><br><span class="line">  -v, --v Level                          number <span class="keyword">for</span> the <span class="built_in">log</span> level verbosity</span><br><span class="line">      --vmodule moduleSpec               comma-separated list of pattern=N settings <span class="keyword">for</span> file-filtered logging</span><br></pre></td></tr></table></figure>

<p>–dry-run看看再：我们看到helm根据chart模板自动帮我们生成了对应的kubernetes yaml文件。</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 这里估计是一个小Bug：我这里指定了namespace为kube-system，但是看到的yaml中没有namespace这项，如下：</span></span><br><span class="line"></span><br><span class="line"><span class="string">$</span> <span class="string">helm</span> <span class="string">install</span> <span class="string">nginx-ingress</span> <span class="string">--namespace=kube-system</span> <span class="string">./</span> <span class="string">--dry-run</span> <span class="string">--debug</span></span><br><span class="line"><span class="attr">install.go:148:</span> <span class="string">[debug]</span> <span class="attr">Original chart version:</span> <span class="string">""</span></span><br><span class="line"><span class="attr">install.go:165:</span> <span class="string">[debug]</span> <span class="attr">CHART PATH:</span> <span class="string">/home/microoak/nginx-ingress</span></span><br><span class="line"></span><br><span class="line"><span class="attr">NAME:</span> <span class="string">nginx-ingress</span></span><br><span class="line"><span class="attr">LAST DEPLOYED:</span> <span class="string">Wed</span> <span class="string">Nov</span> <span class="number">13</span> <span class="number">15</span><span class="string">:54:30</span> <span class="number">2019</span></span><br><span class="line"><span class="attr">NAMESPACE:</span> <span class="string">default</span></span><br><span class="line"><span class="attr">STATUS:</span> <span class="string">pending-install</span></span><br><span class="line"><span class="attr">REVISION:</span> <span class="number">1</span></span><br><span class="line"><span class="attr">TEST SUITE:</span> <span class="string">None</span></span><br><span class="line"><span class="attr">USER-SUPPLIED VALUES:</span></span><br><span class="line"><span class="string">&#123;&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">COMPUTED VALUES:</span></span><br><span class="line"><span class="attr">controller:</span></span><br><span class="line">  <span class="attr">addHeaders:</span> <span class="string">&#123;&#125;</span></span><br><span class="line">  <span class="attr">admissionWebhooks:</span></span><br><span class="line">    <span class="attr">enabled:</span> <span class="literal">false</span></span><br><span class="line">    <span class="attr">failurePolicy:</span> <span class="string">Fail</span></span><br><span class="line">    <span class="attr">patch:</span></span><br><span class="line">      <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line">      <span class="attr">image:</span></span><br><span class="line">        <span class="attr">pullPolicy:</span> <span class="string">IfNotPresent</span></span><br><span class="line">        <span class="attr">repository:</span> <span class="string">jettech/kube-webhook-certgen</span></span><br><span class="line">        <span class="attr">tag:</span> <span class="string">v1.0.0</span></span><br><span class="line">      <span class="attr">nodeSelector:</span> <span class="string">&#123;&#125;</span></span><br><span class="line">      <span class="attr">podAnnotations:</span> <span class="string">&#123;&#125;</span></span><br><span class="line">      <span class="attr">priorityClassName:</span> <span class="string">""</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">8443</span></span><br><span class="line">    <span class="attr">service:</span></span><br><span class="line">      <span class="attr">annotations:</span> <span class="string">&#123;&#125;</span></span><br><span class="line">      <span class="attr">clusterIP:</span> <span class="string">""</span></span><br><span class="line">      <span class="attr">externalIPs:</span> <span class="string">[]</span></span><br><span class="line">      <span class="attr">loadBalancerIP:</span> <span class="string">""</span></span><br><span class="line">      <span class="attr">loadBalancerSourceRanges:</span> <span class="string">[]</span></span><br><span class="line">      <span class="attr">omitClusterIP:</span> <span class="literal">false</span></span><br><span class="line">      <span class="attr">servicePort:</span> <span class="number">443</span></span><br><span class="line">      <span class="attr">type:</span> <span class="string">ClusterIP</span></span><br><span class="line">  <span class="attr">affinity:</span> <span class="string">&#123;&#125;</span></span><br><span class="line">  <span class="attr">autoscaling:</span></span><br><span class="line">    <span class="attr">enabled:</span> <span class="literal">false</span></span><br><span class="line">    <span class="attr">maxReplicas:</span> <span class="number">11</span></span><br><span class="line">    <span class="attr">minReplicas:</span> <span class="number">1</span></span><br><span class="line">    <span class="attr">targetCPUUtilizationPercentage:</span> <span class="number">50</span></span><br><span class="line">    <span class="attr">targetMemoryUtilizationPercentage:</span> <span class="number">50</span></span><br><span class="line">  <span class="attr">config:</span> <span class="string">&#123;&#125;</span></span><br><span class="line">  <span class="attr">configMapNamespace:</span> <span class="string">""</span></span><br><span class="line">  <span class="attr">containerPort:</span></span><br><span class="line">    <span class="attr">http:</span> <span class="number">80</span></span><br><span class="line">    <span class="attr">https:</span> <span class="number">443</span></span><br><span class="line">  <span class="attr">customTemplate:</span></span><br><span class="line">    <span class="attr">configMapKey:</span> <span class="string">""</span></span><br><span class="line">    <span class="attr">configMapName:</span> <span class="string">""</span></span><br><span class="line">  <span class="attr">daemonset:</span></span><br><span class="line">    <span class="attr">hostPorts:</span></span><br><span class="line">      <span class="attr">http:</span> <span class="number">80</span></span><br><span class="line">      <span class="attr">https:</span> <span class="number">443</span></span><br><span class="line">    <span class="attr">useHostPort:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">defaultBackendService:</span> <span class="string">""</span></span><br><span class="line">  <span class="attr">dnsPolicy:</span> <span class="string">ClusterFirst</span></span><br><span class="line">  <span class="attr">electionID:</span> <span class="string">ingress-controller-leader</span></span><br><span class="line">  <span class="attr">extraArgs:</span> <span class="string">&#123;&#125;</span></span><br><span class="line">  <span class="attr">extraContainers:</span> <span class="string">[]</span></span><br><span class="line">  <span class="attr">extraEnvs:</span> <span class="string">[]</span></span><br><span class="line">  <span class="attr">extraInitContainers:</span> <span class="string">[]</span></span><br><span class="line">  <span class="attr">extraVolumeMounts:</span> <span class="string">[]</span></span><br><span class="line">  <span class="attr">extraVolumes:</span> <span class="string">[]</span></span><br><span class="line">  <span class="attr">hostNetwork:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">image:</span></span><br><span class="line">    <span class="attr">allowPrivilegeEscalation:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">pullPolicy:</span> <span class="string">IfNotPresent</span></span><br><span class="line">    <span class="attr">repository:</span> <span class="string">quay.azk8s.cn/kubernetes-ingress-controller/nginx-ingress-controller</span></span><br><span class="line">    <span class="attr">runAsUser:</span> <span class="number">33</span></span><br><span class="line">    <span class="attr">tag:</span> <span class="number">0.26</span><span class="number">.1</span></span><br><span class="line">  <span class="attr">ingressClass:</span> <span class="string">nginx</span></span><br><span class="line">  <span class="attr">kind:</span> <span class="string">DaemonSet</span></span><br><span class="line">  <span class="attr">lifecycle:</span> <span class="string">&#123;&#125;</span></span><br><span class="line">  <span class="attr">livenessProbe:</span></span><br><span class="line">    <span class="attr">failureThreshold:</span> <span class="number">3</span></span><br><span class="line">    <span class="attr">initialDelaySeconds:</span> <span class="number">10</span></span><br><span class="line">    <span class="attr">periodSeconds:</span> <span class="number">10</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">10254</span></span><br><span class="line">    <span class="attr">successThreshold:</span> <span class="number">1</span></span><br><span class="line">    <span class="attr">timeoutSeconds:</span> <span class="number">1</span></span><br><span class="line">  <span class="attr">metrics:</span></span><br><span class="line">    <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">10254</span></span><br><span class="line">    <span class="attr">prometheusRule:</span></span><br><span class="line">      <span class="attr">additionalLabels:</span> <span class="string">&#123;&#125;</span></span><br><span class="line">      <span class="attr">enabled:</span> <span class="literal">false</span></span><br><span class="line">      <span class="attr">namespace:</span> <span class="string">""</span></span><br><span class="line">      <span class="attr">rules:</span> <span class="string">[]</span></span><br><span class="line">    <span class="attr">service:</span></span><br><span class="line">      <span class="attr">annotations:</span> <span class="string">&#123;&#125;</span></span><br><span class="line">      <span class="attr">clusterIP:</span> <span class="string">""</span></span><br><span class="line">      <span class="attr">externalIPs:</span> <span class="string">[]</span></span><br><span class="line">      <span class="attr">loadBalancerIP:</span> <span class="string">""</span></span><br><span class="line">      <span class="attr">loadBalancerSourceRanges:</span> <span class="string">[]</span></span><br><span class="line">      <span class="attr">omitClusterIP:</span> <span class="literal">false</span></span><br><span class="line">      <span class="attr">servicePort:</span> <span class="number">9913</span></span><br><span class="line">      <span class="attr">type:</span> <span class="string">ClusterIP</span></span><br><span class="line">    <span class="attr">serviceMonitor:</span></span><br><span class="line">      <span class="attr">additionalLabels:</span> <span class="string">&#123;&#125;</span></span><br><span class="line">      <span class="attr">enabled:</span> <span class="literal">false</span></span><br><span class="line">      <span class="attr">namespace:</span> <span class="string">""</span></span><br><span class="line">      <span class="attr">scrapeInterval:</span> <span class="string">30s</span></span><br><span class="line">  <span class="attr">minAvailable:</span> <span class="number">1</span></span><br><span class="line">  <span class="attr">minReadySeconds:</span> <span class="number">5</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">controller</span></span><br><span class="line">  <span class="attr">nodeSelector:</span></span><br><span class="line">    <span class="attr">canruningress:</span> <span class="string">run</span></span><br><span class="line">  <span class="attr">podAnnotations:</span> <span class="string">&#123;&#125;</span></span><br><span class="line">  <span class="attr">podLabels:</span> <span class="string">&#123;&#125;</span></span><br><span class="line">  <span class="attr">podSecurityContext:</span> <span class="string">&#123;&#125;</span></span><br><span class="line">  <span class="attr">priorityClassName:</span> <span class="string">""</span></span><br><span class="line">  <span class="attr">proxySetHeaders:</span> <span class="string">&#123;&#125;</span></span><br><span class="line">  <span class="attr">publishService:</span></span><br><span class="line">    <span class="attr">enabled:</span> <span class="literal">false</span></span><br><span class="line">    <span class="attr">pathOverride:</span> <span class="string">""</span></span><br><span class="line">  <span class="attr">readinessProbe:</span></span><br><span class="line">    <span class="attr">failureThreshold:</span> <span class="number">3</span></span><br><span class="line">    <span class="attr">initialDelaySeconds:</span> <span class="number">10</span></span><br><span class="line">    <span class="attr">periodSeconds:</span> <span class="number">10</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">10254</span></span><br><span class="line">    <span class="attr">successThreshold:</span> <span class="number">1</span></span><br><span class="line">    <span class="attr">timeoutSeconds:</span> <span class="number">1</span></span><br><span class="line">  <span class="attr">replicaCount:</span> <span class="number">1</span></span><br><span class="line">  <span class="attr">reportNodeInternalIp:</span> <span class="literal">false</span></span><br><span class="line">  <span class="attr">resources:</span></span><br><span class="line">    <span class="attr">limits:</span></span><br><span class="line">      <span class="attr">cpu:</span> <span class="string">100m</span></span><br><span class="line">      <span class="attr">memory:</span> <span class="string">256Mi</span></span><br><span class="line">    <span class="attr">requests:</span></span><br><span class="line">      <span class="attr">cpu:</span> <span class="string">100m</span></span><br><span class="line">      <span class="attr">memory:</span> <span class="string">128Mi</span></span><br><span class="line">  <span class="attr">scope:</span></span><br><span class="line">    <span class="attr">enabled:</span> <span class="literal">false</span></span><br><span class="line">    <span class="attr">namespace:</span> <span class="string">""</span></span><br><span class="line">  <span class="attr">service:</span></span><br><span class="line">    <span class="attr">annotations:</span> <span class="string">&#123;&#125;</span></span><br><span class="line">    <span class="attr">clusterIP:</span> <span class="string">""</span></span><br><span class="line">    <span class="attr">enableHttp:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">enableHttps:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">externalIPs:</span> <span class="string">[]</span></span><br><span class="line">    <span class="attr">externalTrafficPolicy:</span> <span class="string">""</span></span><br><span class="line">    <span class="attr">healthCheckNodePort:</span> <span class="number">0</span></span><br><span class="line">    <span class="attr">labels:</span> <span class="string">&#123;&#125;</span></span><br><span class="line">    <span class="attr">loadBalancerIP:</span> <span class="string">""</span></span><br><span class="line">    <span class="attr">loadBalancerSourceRanges:</span> <span class="string">[]</span></span><br><span class="line">    <span class="attr">nodePorts:</span></span><br><span class="line">      <span class="attr">http:</span> <span class="string">""</span></span><br><span class="line">      <span class="attr">https:</span> <span class="string">""</span></span><br><span class="line">      <span class="attr">tcp:</span> <span class="string">&#123;&#125;</span></span><br><span class="line">      <span class="attr">udp:</span> <span class="string">&#123;&#125;</span></span><br><span class="line">    <span class="attr">omitClusterIP:</span> <span class="literal">false</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="attr">http:</span> <span class="number">80</span></span><br><span class="line">      <span class="attr">https:</span> <span class="number">443</span></span><br><span class="line">    <span class="attr">targetPorts:</span></span><br><span class="line">      <span class="attr">http:</span> <span class="string">http</span></span><br><span class="line">      <span class="attr">https:</span> <span class="string">https</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">clusterIP</span></span><br><span class="line">  <span class="attr">tcp:</span></span><br><span class="line">    <span class="attr">configMapNamespace:</span> <span class="string">""</span></span><br><span class="line">  <span class="attr">terminationGracePeriodSeconds:</span> <span class="number">60</span></span><br><span class="line">  <span class="attr">tolerations:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">operator:</span> <span class="string">Exists</span></span><br><span class="line">  <span class="attr">udp:</span></span><br><span class="line">    <span class="attr">configMapNamespace:</span> <span class="string">""</span></span><br><span class="line">  <span class="attr">updateStrategy:</span></span><br><span class="line">    <span class="attr">rollingUpdate:</span></span><br><span class="line">      <span class="attr">maxUnavailable:</span> <span class="number">1</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">RollingUpdate</span></span><br><span class="line"><span class="attr">defaultBackend:</span></span><br><span class="line">  <span class="attr">affinity:</span> <span class="string">&#123;&#125;</span></span><br><span class="line">  <span class="attr">enabled:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">extraArgs:</span> <span class="string">&#123;&#125;</span></span><br><span class="line">  <span class="attr">extraEnvs:</span> <span class="string">[]</span></span><br><span class="line">  <span class="attr">image:</span></span><br><span class="line">    <span class="attr">pullPolicy:</span> <span class="string">IfNotPresent</span></span><br><span class="line">    <span class="attr">repository:</span> <span class="string">gcr.azk8s.cn/google-containers/defaultbackend-amd64</span></span><br><span class="line">    <span class="attr">runAsUser:</span> <span class="number">65534</span></span><br><span class="line">    <span class="attr">tag:</span> <span class="string">"1.5"</span></span><br><span class="line">  <span class="attr">livenessProbe:</span></span><br><span class="line">    <span class="attr">failureThreshold:</span> <span class="number">3</span></span><br><span class="line">    <span class="attr">initialDelaySeconds:</span> <span class="number">30</span></span><br><span class="line">    <span class="attr">periodSeconds:</span> <span class="number">10</span></span><br><span class="line">    <span class="attr">successThreshold:</span> <span class="number">1</span></span><br><span class="line">    <span class="attr">timeoutSeconds:</span> <span class="number">5</span></span><br><span class="line">  <span class="attr">minAvailable:</span> <span class="number">1</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">default-backend</span></span><br><span class="line">  <span class="attr">nodeSelector:</span> <span class="string">&#123;&#125;</span></span><br><span class="line">  <span class="attr">podAnnotations:</span> <span class="string">&#123;&#125;</span></span><br><span class="line">  <span class="attr">podLabels:</span> <span class="string">&#123;&#125;</span></span><br><span class="line">  <span class="attr">podSecurityContext:</span> <span class="string">&#123;&#125;</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8080</span></span><br><span class="line">  <span class="attr">priorityClassName:</span> <span class="string">""</span></span><br><span class="line">  <span class="attr">readinessProbe:</span></span><br><span class="line">    <span class="attr">failureThreshold:</span> <span class="number">6</span></span><br><span class="line">    <span class="attr">initialDelaySeconds:</span> <span class="number">0</span></span><br><span class="line">    <span class="attr">periodSeconds:</span> <span class="number">5</span></span><br><span class="line">    <span class="attr">successThreshold:</span> <span class="number">1</span></span><br><span class="line">    <span class="attr">timeoutSeconds:</span> <span class="number">5</span></span><br><span class="line">  <span class="attr">replicaCount:</span> <span class="number">1</span></span><br><span class="line">  <span class="attr">resources:</span></span><br><span class="line">    <span class="attr">limits:</span></span><br><span class="line">      <span class="attr">cpu:</span> <span class="string">10m</span></span><br><span class="line">      <span class="attr">memory:</span> <span class="string">20Mi</span></span><br><span class="line">    <span class="attr">requests:</span></span><br><span class="line">      <span class="attr">cpu:</span> <span class="string">10m</span></span><br><span class="line">      <span class="attr">memory:</span> <span class="string">20Mi</span></span><br><span class="line">  <span class="attr">service:</span></span><br><span class="line">    <span class="attr">annotations:</span> <span class="string">&#123;&#125;</span></span><br><span class="line">    <span class="attr">clusterIP:</span> <span class="string">""</span></span><br><span class="line">    <span class="attr">externalIPs:</span> <span class="string">[]</span></span><br><span class="line">    <span class="attr">loadBalancerIP:</span> <span class="string">""</span></span><br><span class="line">    <span class="attr">loadBalancerSourceRanges:</span> <span class="string">[]</span></span><br><span class="line">    <span class="attr">omitClusterIP:</span> <span class="literal">false</span></span><br><span class="line">    <span class="attr">servicePort:</span> <span class="number">80</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">ClusterIP</span></span><br><span class="line">  <span class="attr">serviceAccount:</span></span><br><span class="line">    <span class="attr">create:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">name:</span> <span class="literal">null</span></span><br><span class="line">  <span class="attr">tolerations:</span> <span class="string">[]</span></span><br><span class="line"><span class="attr">imagePullSecrets:</span> <span class="string">[]</span></span><br><span class="line"><span class="attr">podSecurityPolicy:</span></span><br><span class="line">  <span class="attr">enabled:</span> <span class="literal">false</span></span><br><span class="line"><span class="attr">rbac:</span></span><br><span class="line">  <span class="attr">create:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">revisionHistoryLimit:</span> <span class="number">10</span></span><br><span class="line"><span class="attr">serviceAccount:</span></span><br><span class="line">  <span class="attr">create:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">name:</span> <span class="literal">null</span></span><br><span class="line"><span class="attr">tcp:</span> <span class="string">&#123;&#125;</span></span><br><span class="line"><span class="attr">udp:</span> <span class="string">&#123;&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">HOOKS:</span></span><br><span class="line"><span class="attr">MANIFEST:</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="comment"># Source: nginx-ingress/templates/controller-serviceaccount.yaml</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ServiceAccount</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">nginx-ingress</span></span><br><span class="line">    <span class="attr">chart:</span> <span class="string">nginx-ingress-1.24.7</span></span><br><span class="line">    <span class="attr">heritage:</span> <span class="string">Helm</span></span><br><span class="line">    <span class="attr">release:</span> <span class="string">nginx-ingress</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">nginx-ingress</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="comment"># Source: nginx-ingress/templates/default-backend-serviceaccount.yaml</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ServiceAccount</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">nginx-ingress</span></span><br><span class="line">    <span class="attr">chart:</span> <span class="string">nginx-ingress-1.24.7</span></span><br><span class="line">    <span class="attr">heritage:</span> <span class="string">Helm</span></span><br><span class="line">    <span class="attr">release:</span> <span class="string">nginx-ingress</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">nginx-ingress-backend</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="comment"># Source: nginx-ingress/templates/clusterrole.yaml</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">rbac.authorization.k8s.io/v1beta1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ClusterRole</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">nginx-ingress</span></span><br><span class="line">    <span class="attr">chart:</span> <span class="string">nginx-ingress-1.24.7</span></span><br><span class="line">    <span class="attr">heritage:</span> <span class="string">Helm</span></span><br><span class="line">    <span class="attr">release:</span> <span class="string">nginx-ingress</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">nginx-ingress</span></span><br><span class="line"><span class="attr">rules:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">apiGroups:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">""</span></span><br><span class="line">    <span class="attr">resources:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">configmaps</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">endpoints</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">nodes</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">pods</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">secrets</span></span><br><span class="line">    <span class="attr">verbs:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">list</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">watch</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">apiGroups:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">""</span></span><br><span class="line">    <span class="attr">resources:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">nodes</span></span><br><span class="line">    <span class="attr">verbs:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">get</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">apiGroups:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">""</span></span><br><span class="line">    <span class="attr">resources:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">services</span></span><br><span class="line">    <span class="attr">verbs:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">get</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">list</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">update</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">watch</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">apiGroups:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">extensions</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">"networking.k8s.io"</span> <span class="comment"># k8s 1.14+</span></span><br><span class="line">    <span class="attr">resources:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">ingresses</span></span><br><span class="line">    <span class="attr">verbs:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">get</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">list</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">watch</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">apiGroups:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">""</span></span><br><span class="line">    <span class="attr">resources:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">events</span></span><br><span class="line">    <span class="attr">verbs:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">create</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">patch</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">apiGroups:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">extensions</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">"networking.k8s.io"</span> <span class="comment"># k8s 1.14+</span></span><br><span class="line">    <span class="attr">resources:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">ingresses/status</span></span><br><span class="line">    <span class="attr">verbs:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">update</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="comment"># Source: nginx-ingress/templates/clusterrolebinding.yaml</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">rbac.authorization.k8s.io/v1beta1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ClusterRoleBinding</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">nginx-ingress</span></span><br><span class="line">    <span class="attr">chart:</span> <span class="string">nginx-ingress-1.24.7</span></span><br><span class="line">    <span class="attr">heritage:</span> <span class="string">Helm</span></span><br><span class="line">    <span class="attr">release:</span> <span class="string">nginx-ingress</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">nginx-ingress</span></span><br><span class="line"><span class="attr">roleRef:</span></span><br><span class="line">  <span class="attr">apiGroup:</span> <span class="string">rbac.authorization.k8s.io</span></span><br><span class="line">  <span class="attr">kind:</span> <span class="string">ClusterRole</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">nginx-ingress</span></span><br><span class="line"><span class="attr">subjects:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">kind:</span> <span class="string">ServiceAccount</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">nginx-ingress</span></span><br><span class="line">    <span class="attr">namespace:</span> <span class="string">default</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="comment"># Source: nginx-ingress/templates/controller-role.yaml</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">rbac.authorization.k8s.io/v1beta1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Role</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">nginx-ingress</span></span><br><span class="line">    <span class="attr">chart:</span> <span class="string">nginx-ingress-1.24.7</span></span><br><span class="line">    <span class="attr">heritage:</span> <span class="string">Helm</span></span><br><span class="line">    <span class="attr">release:</span> <span class="string">nginx-ingress</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">nginx-ingress</span></span><br><span class="line"><span class="attr">rules:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">apiGroups:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">""</span></span><br><span class="line">    <span class="attr">resources:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">namespaces</span></span><br><span class="line">    <span class="attr">verbs:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">get</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">apiGroups:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">""</span></span><br><span class="line">    <span class="attr">resources:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">configmaps</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">pods</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">secrets</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">endpoints</span></span><br><span class="line">    <span class="attr">verbs:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">get</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">list</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">watch</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">apiGroups:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">""</span></span><br><span class="line">    <span class="attr">resources:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">services</span></span><br><span class="line">    <span class="attr">verbs:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">get</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">list</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">update</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">watch</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">apiGroups:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">extensions</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">"networking.k8s.io"</span> <span class="comment"># k8s 1.14+</span></span><br><span class="line">    <span class="attr">resources:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">ingresses</span></span><br><span class="line">    <span class="attr">verbs:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">get</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">list</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">watch</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">apiGroups:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">extensions</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">"networking.k8s.io"</span> <span class="comment"># k8s 1.14+</span></span><br><span class="line">    <span class="attr">resources:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">ingresses/status</span></span><br><span class="line">    <span class="attr">verbs:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">update</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">apiGroups:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">""</span></span><br><span class="line">    <span class="attr">resources:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">configmaps</span></span><br><span class="line">    <span class="attr">resourceNames:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">ingress-controller-leader-nginx</span></span><br><span class="line">    <span class="attr">verbs:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">get</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">update</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">apiGroups:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">""</span></span><br><span class="line">    <span class="attr">resources:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">configmaps</span></span><br><span class="line">    <span class="attr">verbs:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">create</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">apiGroups:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">""</span></span><br><span class="line">    <span class="attr">resources:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">endpoints</span></span><br><span class="line">    <span class="attr">verbs:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">create</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">get</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">update</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">apiGroups:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">""</span></span><br><span class="line">    <span class="attr">resources:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">events</span></span><br><span class="line">    <span class="attr">verbs:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">create</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">patch</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="comment"># Source: nginx-ingress/templates/controller-rolebinding.yaml</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">rbac.authorization.k8s.io/v1beta1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">RoleBinding</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">nginx-ingress</span></span><br><span class="line">    <span class="attr">chart:</span> <span class="string">nginx-ingress-1.24.7</span></span><br><span class="line">    <span class="attr">heritage:</span> <span class="string">Helm</span></span><br><span class="line">    <span class="attr">release:</span> <span class="string">nginx-ingress</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">nginx-ingress</span></span><br><span class="line"><span class="attr">roleRef:</span></span><br><span class="line">  <span class="attr">apiGroup:</span> <span class="string">rbac.authorization.k8s.io</span></span><br><span class="line">  <span class="attr">kind:</span> <span class="string">Role</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">nginx-ingress</span></span><br><span class="line"><span class="attr">subjects:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">kind:</span> <span class="string">ServiceAccount</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">nginx-ingress</span></span><br><span class="line">    <span class="attr">namespace:</span> <span class="string">default</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="comment"># Source: nginx-ingress/templates/controller-metrics-service.yaml</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">nginx-ingress</span></span><br><span class="line">    <span class="attr">chart:</span> <span class="string">nginx-ingress-1.24.7</span></span><br><span class="line">    <span class="attr">component:</span> <span class="string">"controller"</span></span><br><span class="line">    <span class="attr">heritage:</span> <span class="string">Helm</span></span><br><span class="line">    <span class="attr">release:</span> <span class="string">nginx-ingress</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">nginx-ingress-controller-metrics</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">clusterIP:</span> <span class="string">""</span></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">metrics</span></span><br><span class="line">      <span class="attr">port:</span> <span class="number">9913</span></span><br><span class="line">      <span class="attr">targetPort:</span> <span class="string">metrics</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">nginx-ingress</span></span><br><span class="line">    <span class="attr">component:</span> <span class="string">"controller"</span></span><br><span class="line">    <span class="attr">release:</span> <span class="string">nginx-ingress</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">"ClusterIP"</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="comment"># Source: nginx-ingress/templates/controller-service.yaml</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">nginx-ingress</span></span><br><span class="line">    <span class="attr">chart:</span> <span class="string">nginx-ingress-1.24.7</span></span><br><span class="line">    <span class="attr">component:</span> <span class="string">"controller"</span></span><br><span class="line">    <span class="attr">heritage:</span> <span class="string">Helm</span></span><br><span class="line">    <span class="attr">release:</span> <span class="string">nginx-ingress</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">nginx-ingress-controller</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">clusterIP:</span> <span class="string">""</span></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">http</span></span><br><span class="line">      <span class="attr">port:</span> <span class="number">80</span></span><br><span class="line">      <span class="attr">protocol:</span> <span class="string">TCP</span></span><br><span class="line">      <span class="attr">targetPort:</span> <span class="string">http</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">https</span></span><br><span class="line">      <span class="attr">port:</span> <span class="number">443</span></span><br><span class="line">      <span class="attr">protocol:</span> <span class="string">TCP</span></span><br><span class="line">      <span class="attr">targetPort:</span> <span class="string">https</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">nginx-ingress</span></span><br><span class="line">    <span class="attr">component:</span> <span class="string">"controller"</span></span><br><span class="line">    <span class="attr">release:</span> <span class="string">nginx-ingress</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">"ClusterIP"</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="comment"># Source: nginx-ingress/templates/default-backend-service.yaml</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">nginx-ingress</span></span><br><span class="line">    <span class="attr">chart:</span> <span class="string">nginx-ingress-1.24.7</span></span><br><span class="line">    <span class="attr">component:</span> <span class="string">"default-backend"</span></span><br><span class="line">    <span class="attr">heritage:</span> <span class="string">Helm</span></span><br><span class="line">    <span class="attr">release:</span> <span class="string">nginx-ingress</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">nginx-ingress-default-backend</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">clusterIP:</span> <span class="string">""</span></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">http</span></span><br><span class="line">      <span class="attr">port:</span> <span class="number">80</span></span><br><span class="line">      <span class="attr">protocol:</span> <span class="string">TCP</span></span><br><span class="line">      <span class="attr">targetPort:</span> <span class="string">http</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">nginx-ingress</span></span><br><span class="line">    <span class="attr">component:</span> <span class="string">"default-backend"</span></span><br><span class="line">    <span class="attr">release:</span> <span class="string">nginx-ingress</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">"ClusterIP"</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="comment"># Source: nginx-ingress/templates/controller-daemonset.yaml</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">DaemonSet</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">nginx-ingress</span></span><br><span class="line">    <span class="attr">chart:</span> <span class="string">nginx-ingress-1.24.7</span></span><br><span class="line">    <span class="attr">component:</span> <span class="string">"controller"</span></span><br><span class="line">    <span class="attr">heritage:</span> <span class="string">Helm</span></span><br><span class="line">    <span class="attr">release:</span> <span class="string">nginx-ingress</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">nginx-ingress-controller</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">nginx-ingress</span></span><br><span class="line">      <span class="attr">release:</span> <span class="string">nginx-ingress</span></span><br><span class="line">  <span class="attr">revisionHistoryLimit:</span> <span class="number">10</span></span><br><span class="line">  <span class="attr">updateStrategy:</span></span><br><span class="line">    <span class="attr">rollingUpdate:</span></span><br><span class="line">      <span class="attr">maxUnavailable:</span> <span class="number">1</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">RollingUpdate</span></span><br><span class="line">  <span class="attr">minReadySeconds:</span> <span class="number">5</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">nginx-ingress</span></span><br><span class="line">        <span class="attr">component:</span> <span class="string">"controller"</span></span><br><span class="line">        <span class="attr">release:</span> <span class="string">nginx-ingress</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">dnsPolicy:</span> <span class="string">ClusterFirst</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nginx-ingress-controller</span></span><br><span class="line">          <span class="attr">image:</span> <span class="string">"quay.azk8s.cn/kubernetes-ingress-controller/nginx-ingress-controller:0.26.1"</span></span><br><span class="line">          <span class="attr">imagePullPolicy:</span> <span class="string">"IfNotPresent"</span></span><br><span class="line">          <span class="attr">args:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">/nginx-ingress-controller</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">--default-backend-service=default/nginx-ingress-default-backend</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">--election-id=ingress-controller-leader</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">--ingress-class=nginx</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">--configmap=default/nginx-ingress-controller</span></span><br><span class="line">          <span class="attr">securityContext:</span></span><br><span class="line">            <span class="attr">capabilities:</span></span><br><span class="line">                <span class="attr">drop:</span></span><br><span class="line">                <span class="bullet">-</span> <span class="string">ALL</span></span><br><span class="line">                <span class="attr">add:</span></span><br><span class="line">                <span class="bullet">-</span> <span class="string">NET_BIND_SERVICE</span></span><br><span class="line">            <span class="attr">runAsUser:</span> <span class="number">33</span></span><br><span class="line">            <span class="attr">allowPrivilegeEscalation:</span> <span class="literal">true</span></span><br><span class="line">          <span class="attr">env:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">POD_NAME</span></span><br><span class="line">              <span class="attr">valueFrom:</span></span><br><span class="line">                <span class="attr">fieldRef:</span></span><br><span class="line">                  <span class="attr">fieldPath:</span> <span class="string">metadata.name</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">POD_NAMESPACE</span></span><br><span class="line">              <span class="attr">valueFrom:</span></span><br><span class="line">                <span class="attr">fieldRef:</span></span><br><span class="line">                  <span class="attr">fieldPath:</span> <span class="string">metadata.namespace</span></span><br><span class="line">          <span class="attr">livenessProbe:</span></span><br><span class="line">            <span class="attr">httpGet:</span></span><br><span class="line">              <span class="attr">path:</span> <span class="string">/healthz</span></span><br><span class="line">              <span class="attr">port:</span> <span class="number">10254</span></span><br><span class="line">              <span class="attr">scheme:</span> <span class="string">HTTP</span></span><br><span class="line">            <span class="attr">initialDelaySeconds:</span> <span class="number">10</span></span><br><span class="line">            <span class="attr">periodSeconds:</span> <span class="number">10</span></span><br><span class="line">            <span class="attr">timeoutSeconds:</span> <span class="number">1</span></span><br><span class="line">            <span class="attr">successThreshold:</span> <span class="number">1</span></span><br><span class="line">            <span class="attr">failureThreshold:</span> <span class="number">3</span></span><br><span class="line">          <span class="attr">ports:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">http</span></span><br><span class="line">              <span class="attr">containerPort:</span> <span class="number">80</span></span><br><span class="line">              <span class="attr">protocol:</span> <span class="string">TCP</span></span><br><span class="line">              <span class="attr">hostPort:</span> <span class="number">80</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">https</span></span><br><span class="line">              <span class="attr">containerPort:</span> <span class="number">443</span></span><br><span class="line">              <span class="attr">protocol:</span> <span class="string">TCP</span></span><br><span class="line">              <span class="attr">hostPort:</span> <span class="number">443</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">metrics</span></span><br><span class="line">              <span class="attr">containerPort:</span> <span class="number">10254</span></span><br><span class="line">              <span class="attr">protocol:</span> <span class="string">TCP</span></span><br><span class="line">          <span class="attr">readinessProbe:</span></span><br><span class="line">            <span class="attr">httpGet:</span></span><br><span class="line">              <span class="attr">path:</span> <span class="string">/healthz</span></span><br><span class="line">              <span class="attr">port:</span> <span class="number">10254</span></span><br><span class="line">              <span class="attr">scheme:</span> <span class="string">HTTP</span></span><br><span class="line">            <span class="attr">initialDelaySeconds:</span> <span class="number">10</span></span><br><span class="line">            <span class="attr">periodSeconds:</span> <span class="number">10</span></span><br><span class="line">            <span class="attr">timeoutSeconds:</span> <span class="number">1</span></span><br><span class="line">            <span class="attr">successThreshold:</span> <span class="number">1</span></span><br><span class="line">            <span class="attr">failureThreshold:</span> <span class="number">3</span></span><br><span class="line">          <span class="attr">resources:</span></span><br><span class="line">            <span class="attr">limits:</span></span><br><span class="line">              <span class="attr">cpu:</span> <span class="string">100m</span></span><br><span class="line">              <span class="attr">memory:</span> <span class="string">256Mi</span></span><br><span class="line">            <span class="attr">requests:</span></span><br><span class="line">              <span class="attr">cpu:</span> <span class="string">100m</span></span><br><span class="line">              <span class="attr">memory:</span> <span class="string">128Mi</span></span><br><span class="line">      <span class="attr">hostNetwork:</span> <span class="literal">true</span></span><br><span class="line">      <span class="attr">nodeSelector:</span></span><br><span class="line">        <span class="attr">canruningress:</span> <span class="string">run</span></span><br><span class="line">      <span class="attr">tolerations:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">operator:</span> <span class="string">Exists</span></span><br><span class="line">      <span class="attr">serviceAccountName:</span> <span class="string">nginx-ingress</span></span><br><span class="line">      <span class="attr">terminationGracePeriodSeconds:</span> <span class="number">60</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="comment"># Source: nginx-ingress/templates/default-backend-deployment.yaml</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">nginx-ingress</span></span><br><span class="line">    <span class="attr">chart:</span> <span class="string">nginx-ingress-1.24.7</span></span><br><span class="line">    <span class="attr">component:</span> <span class="string">"default-backend"</span></span><br><span class="line">    <span class="attr">heritage:</span> <span class="string">Helm</span></span><br><span class="line">    <span class="attr">release:</span> <span class="string">nginx-ingress</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">nginx-ingress-default-backend</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">nginx-ingress</span></span><br><span class="line">      <span class="attr">release:</span> <span class="string">nginx-ingress</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">1</span></span><br><span class="line">  <span class="attr">revisionHistoryLimit:</span> <span class="number">10</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">nginx-ingress</span></span><br><span class="line">        <span class="attr">component:</span> <span class="string">"default-backend"</span></span><br><span class="line">        <span class="attr">release:</span> <span class="string">nginx-ingress</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nginx-ingress-default-backend</span></span><br><span class="line">          <span class="attr">image:</span> <span class="string">"gcr.azk8s.cn/google-containers/defaultbackend-amd64:1.5"</span></span><br><span class="line">          <span class="attr">imagePullPolicy:</span> <span class="string">"IfNotPresent"</span></span><br><span class="line">          <span class="attr">args:</span></span><br><span class="line">          <span class="attr">securityContext:</span></span><br><span class="line">            <span class="attr">runAsUser:</span> <span class="number">65534</span></span><br><span class="line">          <span class="attr">livenessProbe:</span></span><br><span class="line">            <span class="attr">httpGet:</span></span><br><span class="line">              <span class="attr">path:</span> <span class="string">/healthz</span></span><br><span class="line">              <span class="attr">port:</span> <span class="number">8080</span></span><br><span class="line">              <span class="attr">scheme:</span> <span class="string">HTTP</span></span><br><span class="line">            <span class="attr">initialDelaySeconds:</span> <span class="number">30</span></span><br><span class="line">            <span class="attr">periodSeconds:</span> <span class="number">10</span></span><br><span class="line">            <span class="attr">timeoutSeconds:</span> <span class="number">5</span></span><br><span class="line">            <span class="attr">successThreshold:</span> <span class="number">1</span></span><br><span class="line">            <span class="attr">failureThreshold:</span> <span class="number">3</span></span><br><span class="line">          <span class="attr">readinessProbe:</span></span><br><span class="line">            <span class="attr">httpGet:</span></span><br><span class="line">              <span class="attr">path:</span> <span class="string">/healthz</span></span><br><span class="line">              <span class="attr">port:</span> <span class="number">8080</span></span><br><span class="line">              <span class="attr">scheme:</span> <span class="string">HTTP</span></span><br><span class="line">            <span class="attr">initialDelaySeconds:</span> <span class="number">0</span></span><br><span class="line">            <span class="attr">periodSeconds:</span> <span class="number">5</span></span><br><span class="line">            <span class="attr">timeoutSeconds:</span> <span class="number">5</span></span><br><span class="line">            <span class="attr">successThreshold:</span> <span class="number">1</span></span><br><span class="line">            <span class="attr">failureThreshold:</span> <span class="number">6</span></span><br><span class="line">          <span class="attr">ports:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">http</span></span><br><span class="line">              <span class="attr">containerPort:</span> <span class="number">8080</span></span><br><span class="line">              <span class="attr">protocol:</span> <span class="string">TCP</span></span><br><span class="line">          <span class="attr">resources:</span></span><br><span class="line">            <span class="attr">limits:</span></span><br><span class="line">              <span class="attr">cpu:</span> <span class="string">10m</span></span><br><span class="line">              <span class="attr">memory:</span> <span class="string">20Mi</span></span><br><span class="line">            <span class="attr">requests:</span></span><br><span class="line">              <span class="attr">cpu:</span> <span class="string">10m</span></span><br><span class="line">              <span class="attr">memory:</span> <span class="string">20Mi</span></span><br><span class="line">      <span class="attr">serviceAccountName:</span> <span class="string">nginx-ingress-backend</span></span><br><span class="line">      <span class="attr">terminationGracePeriodSeconds:</span> <span class="number">60</span></span><br><span class="line"></span><br><span class="line"><span class="attr">NOTES:</span></span><br><span class="line"><span class="string">The</span> <span class="string">nginx-ingress</span> <span class="string">controller</span> <span class="string">has</span> <span class="string">been</span> <span class="string">installed.</span></span><br><span class="line"></span><br><span class="line"><span class="attr">An example Ingress that makes use of the controller:</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">apiVersion:</span> <span class="string">extensions/v1beta1</span></span><br><span class="line">  <span class="attr">kind:</span> <span class="string">Ingress</span></span><br><span class="line">  <span class="attr">metadata:</span></span><br><span class="line">    <span class="attr">annotations:</span></span><br><span class="line">      <span class="attr">kubernetes.io/ingress.class:</span> <span class="string">nginx</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">example</span></span><br><span class="line">    <span class="attr">namespace:</span> <span class="string">foo</span></span><br><span class="line">  <span class="attr">spec:</span></span><br><span class="line">    <span class="attr">rules:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">host:</span> <span class="string">www.example.com</span></span><br><span class="line">        <span class="attr">http:</span></span><br><span class="line">          <span class="attr">paths:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">backend:</span></span><br><span class="line">                <span class="attr">serviceName:</span> <span class="string">exampleService</span></span><br><span class="line">                <span class="attr">servicePort:</span> <span class="number">80</span></span><br><span class="line">              <span class="attr">path:</span> <span class="string">/</span></span><br><span class="line">    <span class="comment"># This section is only required if TLS is to be enabled for the Ingress</span></span><br><span class="line">    <span class="attr">tls:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">hosts:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">www.example.com</span></span><br><span class="line">          <span class="attr">secretName:</span> <span class="string">example-tls</span></span><br><span class="line"></span><br><span class="line"><span class="string">If</span> <span class="string">TLS</span> <span class="string">is</span> <span class="string">enabled</span> <span class="string">for</span> <span class="string">the</span> <span class="string">Ingress,</span> <span class="attr">a Secret containing the certificate and key must also be provided:</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line">  <span class="attr">kind:</span> <span class="string">Secret</span></span><br><span class="line">  <span class="attr">metadata:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">example-tls</span></span><br><span class="line">    <span class="attr">namespace:</span> <span class="string">foo</span></span><br><span class="line">  <span class="attr">data:</span></span><br><span class="line">    <span class="attr">tls.crt:</span> <span class="string">&lt;base64</span> <span class="string">encoded</span> <span class="string">cert&gt;</span></span><br><span class="line">    <span class="attr">tls.key:</span> <span class="string">&lt;base64</span> <span class="string">encoded</span> <span class="string">key&gt;</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">kubernetes.io/tls</span></span><br></pre></td></tr></table></figure>

<p>正式安装：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ helm install nginx-ingress --namespace=kube-system ./ </span><br><span class="line">NAME: nginx-ingress</span><br><span class="line">LAST DEPLOYED: Wed Nov 13 16:05:22 2019</span><br><span class="line">NAMESPACE: kube-system</span><br><span class="line">STATUS: deployed</span><br><span class="line">REVISION: 1</span><br><span class="line">TEST SUITE: None</span><br><span class="line">NOTES:</span><br><span class="line">The nginx-ingress controller has been installed.</span><br><span class="line">Get the application URL by running these commands:</span><br><span class="line">  <span class="built_in">export</span> POD_NAME=$(kubectl --namespace kube-system get pods -o jsonpath=<span class="string">"&#123;.items[0].metadata.name&#125;"</span> -l <span class="string">"app=nginx-ingress,component=controller,release=nginx-ingress"</span>)</span><br><span class="line">  kubectl --namespace kube-system port-forward <span class="variable">$POD_NAME</span> 8080:80</span><br><span class="line">  <span class="built_in">echo</span> <span class="string">"Visit http://127.0.0.1:8080 to access your application."</span></span><br><span class="line"></span><br><span class="line">An example Ingress that makes use of the controller:</span><br><span class="line"></span><br><span class="line">  apiVersion: extensions/v1beta1</span><br><span class="line">  kind: Ingress</span><br><span class="line">  metadata:</span><br><span class="line">    annotations:</span><br><span class="line">      kubernetes.io/ingress.class: nginx</span><br><span class="line">    name: example</span><br><span class="line">    namespace: foo</span><br><span class="line">  spec:</span><br><span class="line">    rules:</span><br><span class="line">      - host: www.example.com</span><br><span class="line">        http:</span><br><span class="line">          paths:</span><br><span class="line">            - backend:</span><br><span class="line">                serviceName: exampleService</span><br><span class="line">                servicePort: 80</span><br><span class="line">              path: /</span><br><span class="line">    <span class="comment"># This section is only required if TLS is to be enabled for the Ingress</span></span><br><span class="line">    tls:</span><br><span class="line">        - hosts:</span><br><span class="line">            - www.example.com</span><br><span class="line">          secretName: example-tls</span><br><span class="line"></span><br><span class="line">If TLS is enabled <span class="keyword">for</span> the Ingress, a Secret containing the certificate and key must also be provided:</span><br><span class="line"></span><br><span class="line">  apiVersion: v1</span><br><span class="line">  kind: Secret</span><br><span class="line">  metadata:</span><br><span class="line">    name: example-tls</span><br><span class="line">    namespace: foo</span><br><span class="line">  data:</span><br><span class="line">    tls.crt: &lt;base64 encoded cert&gt;</span><br><span class="line">    tls.key: &lt;base64 encoded key&gt;</span><br><span class="line">  <span class="built_in">type</span>: kubernetes.io/tls</span><br></pre></td></tr></table></figure>



<p>安装完成，查看一下吧：</p>
<p>helm：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ helm ls</span><br><span class="line">NAME	NAMESPACE	REVISION	UPDATED	STATUS	CHART	APP VERSION</span><br><span class="line"></span><br><span class="line"><span class="comment"># 噫，为啥是空的？我明明安装了啊？还记的helm env嘛？来看一下再：</span></span><br><span class="line">$ helm env</span><br><span class="line">HELM_DEBUG=<span class="string">"false"</span></span><br><span class="line">HELM_PLUGINS=<span class="string">"/home/user/.local/share/helm/plugins"</span></span><br><span class="line">HELM_REGISTRY_CONFIG=<span class="string">"/home/user/.config/helm/registry.json"</span></span><br><span class="line">HELM_REPOSITORY_CACHE=<span class="string">"/home/user/.cache/helm/repository"</span></span><br><span class="line">HELM_REPOSITORY_CONFIG=<span class="string">"/home/user/.config/helm/repositories.yaml"</span></span><br><span class="line">HELM_NAMESPACE=<span class="string">"default"</span></span><br><span class="line">HELM_KUBECONTEXT=<span class="string">""</span></span><br><span class="line">HELM_BIN=<span class="string">"helm"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 看到了啥？</span></span><br><span class="line">HELM_NAMESPACE=<span class="string">"default"</span></span><br><span class="line"><span class="comment"># 哦我们helm ls默认是查看的defaut命名空间啊，需要加上--namespace=kube-system的</span></span><br><span class="line">$ helm ls --namespace=kube-system</span><br><span class="line">NAME         	NAMESPACE  	REVISION	UPDATED                                	STATUS  	CHART               	APP VERSION</span><br><span class="line">nginx-ingress	kube-system	1       	2019-11-13 16:05:22.499188795 +0800 CST	deployed	nginx-ingress-1.24.7	0.26.1</span><br></pre></td></tr></table></figure>

<p>kubectl：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ kubectl -n kube-system get po</span><br><span class="line">NAME                                             READY   STATUS    RESTARTS   AGE</span><br><span class="line">calico-kube-controllers-7b4657785d-7gw8s         1/1     Running   0          22h</span><br><span class="line">calico-node-cwwpx                                1/1     Running   0          22h</span><br><span class="line">calico-node-t4msz                                1/1     Running   0          22h</span><br><span class="line">calico-node-v26zq                                1/1     Running   0          22h</span><br><span class="line">coredns-5c98db65d4-f6bjz                         1/1     Running   0          26h</span><br><span class="line">coredns-5c98db65d4-xn6fg                         1/1     Running   0          26h</span><br><span class="line">etcd-k8s01.test.awsbj.cn                         1/1     Running   0          26h</span><br><span class="line">kube-apiserver-k8s01.test.awsbj.cn               1/1     Running   0          26h</span><br><span class="line">kube-controller-manager-k8s01.test.awsbj.cn      1/1     Running   0          26h</span><br><span class="line">kube-proxy-9gtz5                                 1/1     Running   0          26h</span><br><span class="line">kube-proxy-pwb7l                                 1/1     Running   0          26h</span><br><span class="line">kube-proxy-qm9q8                                 1/1     Running   0          26h</span><br><span class="line">kube-scheduler-k8s01.test.awsbj.cn               1/1     Running   0          26h</span><br><span class="line">nginx-ingress-controller-228lr                   1/1     Running   0          11m</span><br><span class="line">nginx-ingress-default-backend-576bbf498f-2kxns   1/1     Running   0          11m</span><br><span class="line"></span><br><span class="line"><span class="comment"># 看见最后两个没，一个是nginx-ingress-controller，一个是默认的后端</span></span><br></pre></td></tr></table></figure>



<div class="note info">
            <p>kubectl小技巧：</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 配置好kubectl自动补全</span></span><br><span class="line"></span><br><span class="line">$ cat &gt;&gt; ~/.bashrc &lt;&lt;EOF</span><br><span class="line"><span class="built_in">source</span> &lt;(kubectl completion bash)</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line"><span class="comment"># 应用</span></span><br><span class="line">$ <span class="built_in">source</span> ~/.bashrc</span><br></pre></td></tr></table></figure><p>然后如果想要查看某个命名空间下的资源时，要先-n NAMESPACE来来指定名称空间，然后就可以tab了，很方便的。</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ kubectl -n kube-system &lt;tab键&gt;</span><br><span class="line">annotate       apply          autoscale      completion     cordon         delete         drain          explain        kustomize      options        port-forward   rollout        <span class="built_in">set</span>            uncordon       </span><br><span class="line">api-resources  attach         certificate    config         cp             describe       edit           expose         label          patch          proxy          run            taint          version        </span><br><span class="line">api-versions   auth           cluster-info   convert        create         diff           <span class="built_in">exec</span>           get            logs           plugin         replace        scale          top            <span class="built_in">wait</span></span><br></pre></td></tr></table></figure><p>同理也是适用于helm的：</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ helm -n kube- &lt;tab键&gt;</span><br><span class="line">kube-node-lease  kube-public      kube-system      </span><br><span class="line"></span><br><span class="line">$ helm -n kube-system status nginx-ingress <span class="comment"># 输入完status，直接tab键，如果只有一个默认就自动帮你输入上了。</span></span><br><span class="line">NAME: nginx-ingress</span><br><span class="line">LAST DEPLOYED: Wed Nov 13 16:05:22 2019</span><br><span class="line">NAMESPACE: kube-system</span><br><span class="line">STATUS: deployed</span><br><span class="line">REVISION: 1</span><br><span class="line">TEST SUITE: None</span><br><span class="line">NOTES:</span><br><span class="line">The nginx-ingress controller has been installed.</span><br><span class="line">Get the application URL by running these commands:</span><br><span class="line">  <span class="built_in">export</span> POD_NAME=$(kubectl --namespace kube-system get pods -o jsonpath=<span class="string">"&#123;.items[0].metadata.name&#125;"</span> -l <span class="string">"app=nginx-ingress,component=controller,release=nginx-ingress"</span>)</span><br><span class="line">  kubectl --namespace kube-system port-forward <span class="variable">$POD_NAME</span> 8080:80</span><br><span class="line">  <span class="built_in">echo</span> <span class="string">"Visit http://127.0.0.1:8080 to access your application."</span></span><br><span class="line"></span><br><span class="line">An example Ingress that makes use of the controller:</span><br><span class="line"></span><br><span class="line">  apiVersion: extensions/v1beta1</span><br><span class="line">  kind: Ingress</span><br><span class="line">  metadata:</span><br><span class="line">    annotations:</span><br><span class="line">      kubernetes.io/ingress.class: nginx</span><br><span class="line">    name: example</span><br><span class="line">    namespace: foo</span><br><span class="line">  spec:</span><br><span class="line">    rules:</span><br><span class="line">      - host: www.example.com</span><br><span class="line">        http:</span><br><span class="line">          paths:</span><br><span class="line">            - backend:</span><br><span class="line">                serviceName: exampleService</span><br><span class="line">                servicePort: 80</span><br><span class="line">              path: /</span><br><span class="line">    <span class="comment"># This section is only required if TLS is to be enabled for the Ingress</span></span><br><span class="line">    tls:</span><br><span class="line">        - hosts:</span><br><span class="line">            - www.example.com</span><br><span class="line">          secretName: example-tls</span><br><span class="line"></span><br><span class="line">If TLS is enabled <span class="keyword">for</span> the Ingress, a Secret containing the certificate and key must also be provided:</span><br><span class="line"></span><br><span class="line">  apiVersion: v1</span><br><span class="line">  kind: Secret</span><br><span class="line">  metadata:</span><br><span class="line">    name: example-tls</span><br><span class="line">    namespace: foo</span><br><span class="line">  data:</span><br><span class="line">    tls.crt: &lt;base64 encoded cert&gt;</span><br><span class="line">    tls.key: &lt;base64 encoded key&gt;</span><br><span class="line">  <span class="built_in">type</span>: kubernetes.io/tls</span><br></pre></td></tr></table></figure>
          </div>



<h3 id="测试nginx-ingress"><a href="#测试nginx-ingress" class="headerlink" title="测试nginx-ingress"></a>测试nginx-ingress</h3><p>nginx-ingress安装完了，测试一下吧：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ curl localhost</span><br><span class="line">default backend - 404</span><br><span class="line"></span><br><span class="line"><span class="comment"># 返回了默认的404，因为我们还没有配置ingress呢。</span></span><br></pre></td></tr></table></figure>



<h4 id="创建nginx-deploy："><a href="#创建nginx-deploy：" class="headerlink" title="创建nginx deploy："></a>创建nginx deploy：</h4><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="string">$</span> <span class="string">cat</span> <span class="string">nginx-deploy.yaml</span> </span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">default</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">nginx</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">nginx</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">nginx:1.16-alpine</span></span><br><span class="line">        <span class="attr">ports:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">http</span></span><br><span class="line">          <span class="attr">containerPort:</span> <span class="number">80</span></span><br></pre></td></tr></table></figure>

<p>应用：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ kubectl apply -f nginx-deploy.yaml </span><br><span class="line">deployment.apps/nginx created</span><br></pre></td></tr></table></figure>



<h4 id="创建nginx-service"><a href="#创建nginx-service" class="headerlink" title="创建nginx service:"></a>创建nginx service:</h4><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="string">$</span> <span class="string">cat</span> <span class="string">nginx-service.yaml</span> </span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">default</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">ClusterIP</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">nginx</span></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">http</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">80</span></span><br><span class="line">    <span class="attr">protocol:</span> <span class="string">TCP</span></span><br><span class="line">    <span class="attr">targetPort:</span> <span class="string">http</span></span><br></pre></td></tr></table></figure>

<p>应用：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ kubectl apply -f nginx-service.yaml </span><br><span class="line">service/nginx created</span><br></pre></td></tr></table></figure>

<h4 id="创建nginx-ingress-规则"><a href="#创建nginx-ingress-规则" class="headerlink" title="创建nginx ingress 规则"></a>创建nginx ingress 规则</h4><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="string">$</span> <span class="string">cat</span> <span class="string">nginx-ingress.yaml</span> </span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">extensions/v1beta1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Ingress</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line">  <span class="attr">annotations:</span></span><br><span class="line">    <span class="attr">kubernetes.io/ingress.class:</span> <span class="string">nginx</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">default</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">rules:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">host:</span> <span class="string">nginx.test.com</span></span><br><span class="line">    <span class="attr">http:</span></span><br><span class="line">      <span class="attr">paths:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">backend:</span></span><br><span class="line">          <span class="attr">serviceName:</span> <span class="string">nginx</span></span><br><span class="line">          <span class="attr">servicePort:</span> <span class="number">80</span></span><br><span class="line">        <span class="attr">path:</span> <span class="string">/</span></span><br></pre></td></tr></table></figure>

<p>应用：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ kubectl apply -f nginx-ingress.yaml </span><br><span class="line">ingress.extensions/nginx created</span><br></pre></td></tr></table></figure>

<p>检查：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ kubectl get deploy,pod,svc,ingress</span><br><span class="line">NAME                          READY   UP-TO-DATE   AVAILABLE   AGE</span><br><span class="line">deployment.extensions/nginx   1/1     1            1           15m</span><br><span class="line"></span><br><span class="line">NAME                        READY   STATUS    RESTARTS   AGE</span><br><span class="line">pod/nginx-9cb7f8c7d-wk89s   1/1     Running   0          15m</span><br><span class="line"></span><br><span class="line">NAME                 TYPE        CLUSTER-IP     EXTERNAL-IP   PORT(S)   AGE</span><br><span class="line">service/kubernetes   ClusterIP   10.100.0.1     &lt;none&gt;        443/TCP   27h</span><br><span class="line">service/nginx        ClusterIP   10.100.54.82   &lt;none&gt;        80/TCP    11m</span><br><span class="line"></span><br><span class="line">NAME                       HOSTS            ADDRESS   PORTS   AGE</span><br><span class="line">ingress.extensions/nginx   nginx.test.com             80      8m13s</span><br></pre></td></tr></table></figure>

<p>测试ingress，因为master节点已经安装了nginx-ingress-controller并且使用的是hostNetwork，为了排除感染，我们登陆到worker节点测试：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ curl 172.17.0.7</span><br><span class="line">default backend - 404</span><br><span class="line"></span><br><span class="line"><span class="comment"># 通过IP访问master节点，返回是404，因为我们的ingress规则配置了是nginx.test.com域名访问</span></span><br><span class="line"><span class="comment"># 我们加上主机头：Host: nginx.test.com 访问到了nginx pod。</span></span><br><span class="line">$ curl -H <span class="string">"Host: nginx.test.com"</span> 172.17.0.7</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;title&gt;Welcome to nginx!&lt;/title&gt;</span><br><span class="line">&lt;style&gt;</span><br><span class="line">    body &#123;</span><br><span class="line">        width: 35em;</span><br><span class="line">        margin: 0 auto;</span><br><span class="line">        font-family: Tahoma, Verdana, Arial, sans-serif;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/style&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;h1&gt;Welcome to nginx!&lt;/h1&gt;</span><br><span class="line">&lt;p&gt;If you see this page, the nginx web server is successfully installed and</span><br><span class="line">working. Further configuration is required.&lt;/p&gt;</span><br><span class="line"></span><br><span class="line">&lt;p&gt;For online documentation and support please refer to</span><br><span class="line">&lt;a href=<span class="string">"http://nginx.org/"</span>&gt;nginx.org&lt;/a&gt;.&lt;br/&gt;</span><br><span class="line">Commercial support is available at</span><br><span class="line">&lt;a href=<span class="string">"http://nginx.com/"</span>&gt;nginx.com&lt;/a&gt;.&lt;/p&gt;</span><br><span class="line"></span><br><span class="line">&lt;p&gt;&lt;em&gt;Thank you <span class="keyword">for</span> using nginx.&lt;/em&gt;&lt;/p&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>



<div class="note info">
            <p>小疑问：</p><p>我安装的nginx的pod、service，ingress都是在default空间下，而我的nginx-ingress-controller安装kube-system下，配置的ingress为啥能够访问呢？</p><p>解释：</p><p>首先namespace只是逻辑的分组，并不是隔离的，所以不同namespace下默认的pod是可以互相访问的。当然后面可以用个网络规则禁止掉。</p><p>其次：我们来查看一下nginx-ingress-controller的启动参数吧：</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ kubectl -n kube-system get po nginx-ingress-controller-228lr -o yaml</span><br><span class="line">...</span><br><span class="line">  containers:</span><br><span class="line">  - args:</span><br><span class="line">    - /nginx-ingress-controller</span><br><span class="line">    - --default-backend-service=kube-system/nginx-ingress-default-backend</span><br><span class="line">    - --election-id=ingress-controller-leader</span><br><span class="line">    - --ingress-class=nginx</span><br><span class="line">    - --configmap=kube-system/nginx-ingress-controller</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>在进入到nginx-ingress-controller容器内部看看命令的参数：</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ kubectl -n kube-system <span class="built_in">exec</span> -it nginx-ingress-controller-228lr -- bash</span><br><span class="line"></span><br><span class="line">$ /nginx-ingress-controller --<span class="built_in">help</span></span><br><span class="line">-------------------------------------------------------------------------------</span><br><span class="line">NGINX Ingress controller</span><br><span class="line">  Release:       0.26.1</span><br><span class="line">  Build:         git-2de5a893a</span><br><span class="line">  Repository:    https://github.com/kubernetes/ingress-nginx</span><br><span class="line">  nginx version: openresty/1.15.8.2</span><br><span class="line"></span><br><span class="line">-------------------------------------------------------------------------------</span><br><span class="line"></span><br><span class="line">Usage of :</span><br><span class="line">      --add_dir_header                          If <span class="literal">true</span>, adds the file directory to the header</span><br><span class="line">      --alsologtostderr                         <span class="built_in">log</span> to standard error as well as files</span><br><span class="line">      --annotations-prefix string               Prefix of the Ingress annotations specific to the NGINX controller. (default <span class="string">"nginx.ingress.kubernetes.io"</span>)</span><br><span class="line">      --apiserver-host string                   Address of the Kubernetes API server.</span><br><span class="line">                                                Takes the form <span class="string">"protocol://address:port"</span>. If not specified, it is assumed the</span><br><span class="line">                                                program runs inside a Kubernetes cluster and <span class="built_in">local</span> discovery is attempted.</span><br><span class="line">      --configmap string                        Name of the ConfigMap containing custom global configurations <span class="keyword">for</span> the controller.</span><br><span class="line">      --default-backend-service string          Service used to serve HTTP requests not matching any known server name (catch-all).</span><br><span class="line">                                                Takes the form <span class="string">"namespace/name"</span>. The controller configures NGINX to forward</span><br><span class="line">                                                requests to the first port of this Service.</span><br><span class="line">      --default-server-port int                 Port to use <span class="keyword">for</span> exposing the default server (catch-all). (default 8181)</span><br><span class="line">      --default-ssl-certificate string          Secret containing a SSL certificate to be used by the default HTTPS server (catch-all).</span><br><span class="line">                                                Takes the form <span class="string">"namespace/name"</span>.</span><br><span class="line">      --<span class="built_in">disable</span>-catch-all                       Disable support <span class="keyword">for</span> catch-all Ingresses</span><br><span class="line">      --election-id string                      Election id to use <span class="keyword">for</span> Ingress status updates. (default <span class="string">"ingress-controller-leader"</span>)</span><br><span class="line">      --<span class="built_in">enable</span>-metrics                          Enables the collection of NGINX metrics (default <span class="literal">true</span>)</span><br><span class="line">      --<span class="built_in">enable</span>-ssl-chain-completion             Autocomplete SSL certificate chains with missing intermediate CA certificates.</span><br><span class="line">                                                Certificates uploaded to Kubernetes must have the <span class="string">"Authority Information Access"</span> X.509 v3</span><br><span class="line">                                                extension <span class="keyword">for</span> this to succeed.</span><br><span class="line">      --<span class="built_in">enable</span>-ssl-passthrough                  Enable SSL Passthrough.</span><br><span class="line">      --health-check-path string                URL path of the health check endpoint.</span><br><span class="line">                                                Configured inside the NGINX status server. All requests received on the port</span><br><span class="line">                                                defined by the healthz-port parameter are forwarded internally to this path. (default <span class="string">"/healthz"</span>)</span><br><span class="line">      --health-check-timeout int                Time <span class="built_in">limit</span>, <span class="keyword">in</span> seconds, <span class="keyword">for</span> a probe to health-check-path to succeed. (default 10)</span><br><span class="line">      --healthz-port int                        Port to use <span class="keyword">for</span> the healthz endpoint. (default 10254)</span><br><span class="line">      --http-port int                           Port to use <span class="keyword">for</span> servicing HTTP traffic. (default 80)</span><br><span class="line">      --https-port int                          Port to use <span class="keyword">for</span> servicing HTTPS traffic. (default 443)</span><br><span class="line">      --ingress-class string                    Name of the ingress class this controller satisfies.</span><br><span class="line">                                                The class of an Ingress object is <span class="built_in">set</span> using the annotation <span class="string">"kubernetes.io/ingress.class"</span>.</span><br><span class="line">                                                All ingress classes are satisfied <span class="keyword">if</span> this parameter is left empty.</span><br><span class="line">      --kubeconfig string                       Path to a kubeconfig file containing authorization and API server information.</span><br><span class="line">      --log_backtrace_at traceLocation          when logging hits line file:N, emit a stack trace (default :0)</span><br><span class="line">      --log_dir string                          If non-empty, write <span class="built_in">log</span> files <span class="keyword">in</span> this directory</span><br><span class="line">      --log_file string                         If non-empty, use this <span class="built_in">log</span> file</span><br><span class="line">      --log_file_max_size uint                  Defines the maximum size a <span class="built_in">log</span> file can grow to. Unit is megabytes. If the value is 0, the maximum file size is unlimited. (default 1800)</span><br><span class="line">      --logtostderr                             <span class="built_in">log</span> to standard error instead of files (default <span class="literal">true</span>)</span><br><span class="line">      --metrics-per-host                        Export metrics per-host (default <span class="literal">true</span>)</span><br><span class="line">      --profiler-port int                       Port to use <span class="keyword">for</span> expose the ingress controller Go profiler when it is enabled. (default 10245)</span><br><span class="line">      --profiling                               Enable profiling via web interface host:port/debug/pprof/ (default <span class="literal">true</span>)</span><br><span class="line">      --publish-service string                  Service fronting the Ingress controller.</span><br><span class="line">                                                Takes the form <span class="string">"namespace/name"</span>. When used together with update-status, the</span><br><span class="line">                                                controller mirrors the address of this service<span class="string">'s endpoints to the load-balancer</span></span><br><span class="line"><span class="string">                                                status of all Ingress objects it satisfies.</span></span><br><span class="line"><span class="string">      --publish-status-address string           Customized address to set as the load-balancer status of Ingress objects this controller satisfies.</span></span><br><span class="line"><span class="string">                                                Requires the update-status parameter.</span></span><br><span class="line"><span class="string">      --report-node-internal-ip-address         Set the load-balancer status of Ingress objects to internal Node addresses instead of external.</span></span><br><span class="line"><span class="string">                                                Requires the update-status parameter.</span></span><br><span class="line"><span class="string">      --skip_headers                            If true, avoid header prefixes in the log messages</span></span><br><span class="line"><span class="string">      --skip_log_headers                        If true, avoid headers when opening log files</span></span><br><span class="line"><span class="string">      --ssl-passthrough-proxy-port int          Port to use internally for SSL Passthrough. (default 442)</span></span><br><span class="line"><span class="string">      --status-port int                         Port to use for the lua HTTP endpoint configuration. (default 10246)</span></span><br><span class="line"><span class="string">      --stderrthreshold severity                logs at or above this threshold go to stderr (default 2)</span></span><br><span class="line"><span class="string">      --stream-port int                         Port to use for the lua TCP/UDP endpoint configuration. (default 10247)</span></span><br><span class="line"><span class="string">      --sync-period duration                    Period at which the controller forces the repopulation of its local object stores. Disabled by default.</span></span><br><span class="line"><span class="string">      --sync-rate-limit float32                 Define the sync frequency upper limit (default 0.3)</span></span><br><span class="line"><span class="string">      --tcp-services-configmap string           Name of the ConfigMap containing the definition of the TCP services to expose.</span></span><br><span class="line"><span class="string">                                                The key in the map indicates the external port to be used. The value is a</span></span><br><span class="line"><span class="string">                                                reference to a Service in the form "namespace/name:port", where "port" can</span></span><br><span class="line"><span class="string">                                                either be a port number or name. TCP ports 80 and 443 are reserved by the</span></span><br><span class="line"><span class="string">                                                controller for servicing HTTP traffic.</span></span><br><span class="line"><span class="string">      --udp-services-configmap string           Name of the ConfigMap containing the definition of the UDP services to expose.</span></span><br><span class="line"><span class="string">                                                The key in the map indicates the external port to be used. The value is a</span></span><br><span class="line"><span class="string">                                                reference to a Service in the form "namespace/name:port", where "port" can</span></span><br><span class="line"><span class="string">                                                either be a port name or number.</span></span><br><span class="line"><span class="string">      --update-status                           Update the load-balancer status of Ingress objects this controller satisfies.</span></span><br><span class="line"><span class="string">                                                Requires setting the publish-service parameter to a valid Service reference. (default true)</span></span><br><span class="line"><span class="string">      --update-status-on-shutdown               Update the load-balancer status of Ingress objects when the controller shuts down.</span></span><br><span class="line"><span class="string">                                                Requires the update-status parameter. (default true)</span></span><br><span class="line"><span class="string">  -v, --v Level                                 number for the log level verbosity</span></span><br><span class="line"><span class="string">      --validating-webhook string               The address to start an admission controller on to validate incoming ingresses.</span></span><br><span class="line"><span class="string">                                                Takes the form "&lt;host&gt;:port". If not provided, no admission controller is started.</span></span><br><span class="line"><span class="string">      --validating-webhook-certificate string   The path of the validating webhook certificate PEM.</span></span><br><span class="line"><span class="string">      --validating-webhook-key string           The path of the validating webhook key PEM.</span></span><br><span class="line"><span class="string">      --version                                 Show release information about the NGINX Ingress controller and exit.</span></span><br><span class="line"><span class="string">      --vmodule moduleSpec                      comma-separated list of pattern=N settings for file-filtered logging</span></span><br><span class="line"><span class="string">      --watch-namespace string                  Namespace the controller watches for updates to Kubernetes objects.</span></span><br><span class="line"><span class="string">                                                This includes Ingresses, Services and all configuration resources. All</span></span><br><span class="line"><span class="string">                                                namespaces are watched if this parameter is left empty.</span></span><br></pre></td></tr></table></figure><p>注意到有一条参数：</p><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">--watch-namespace string</span><br><span class="line">Namespace the controller watches for updates to Kubernetes objects.This includes Ingresses, Services and all configuration resources. All namespaces are watched if this parameter is left empty.</span><br><span class="line"></span><br><span class="line">解释：如果这个为空，代表watches所有kubernetes namespace下的ingresses，通过默认的nginx-ingress-controller启动参数我们发现没有这个参数：--watch-namespace，所以也就说明了上面的疑问。</span><br></pre></td></tr></table></figure><div class="note danger">            <p>这里衍生出了生产的建议：</p><p>可以安装配置多个nginx-ingress-controller组来分担不同的服务域名，比如：一组nginx-ingress-controller监听namespace SVCA，通过域名访问SVCA.test.com；</p><p>另一组nginx-ingress-controller监听另一个namespace SVCB，通过域名访问：SVCB.test.com；</p><p>而每组nginx-ingress-controller都结合前面的建议，各自放到独立的主机上，启动多台；</p><p>这样就把域名分开了，而不会都配置到一个nginx-ingress-controller而造成一挂全挂的局面。</p>          </div>
          </div>



<blockquote>
<p>本文到这里就结束了，欢迎期待后面的文章。您可以关注下方的公众号二维码，在第一时间查看新文章。</p>
<p><img src="https://imgs.knner.wang/images/knner/wx.jpg" alt="公众号"></p>
</blockquote>

    </div>

    
    
    
      
        <div class="reward-container">
  <div>如有疏忽错误欢迎在留言区评论指正，如果对您有所帮助欢迎点击下方进行打赏。</div>
  <button disable="enable" onclick="var qr = document.getElementById(&quot;qr&quot;); qr.style.display = (qr.style.display === 'none') ? 'block' : 'none';">
    打赏
  </button>
  <div id="qr" style="display: none;">
      
      <div style="display: inline-block;">
        <img src="/images/knner/wechatpay.jpg" alt="Knner.Wang 微信支付">
        <p>微信支付</p>
      </div>
      
      <div style="display: inline-block;">
        <img src="/images/knner/alipay.jpg" alt="Knner.Wang 支付宝">
        <p>支付宝</p>
      </div>

  </div>
</div>

        

<div>
<ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>本文作者： </strong>Knner.Wang
  </li>
  <li class="post-copyright-link">
    <strong>本文链接：</strong>
    <a href="https://knner.wang/2019/11/14/Pre-trial-helm3.html" title="抢先试用Helm3，并安装nginx-ingress-controller">https://knner.wang/2019/11/14/Pre-trial-helm3.html</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/null" rel="noopener" target="_blank"><i class="fa fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！
  </li>
</ul>
</div>


      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/helm/" rel="tag"># helm</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-next post-nav-item">
                <a href="/2019/11/13/docker-io-gcr-io-k8s-gcr-io-quay-io-Chinese-source.html" rel="next" title="docker.io gcr.io k8s.gcr.io quay.io 中国区加速">
                  <i class="fa fa-chevron-left"></i> docker.io gcr.io k8s.gcr.io quay.io 中国区加速
                </a>
            </div>

            <span class="post-nav-divider"></span>

            <div class="post-nav-prev post-nav-item">
                <a href="/2019/11/20/Prometheus-Operator-test.html" rel="prev" title="Prometheus-Operator 手动入门实战">
                  Prometheus-Operator 手动入门实战 <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
      </footer>
    
  </article>
  
  
  

  </div>


          </div>
          
    
  <div class="comments" id="comments">
    <div id="disqus_thread">
      <noscript>Please enable JavaScript to view the comments powered by Disqus.</noscript>
    </div>
  </div>
  

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#前提依赖"><span class="nav-number">1.</span> <span class="nav-text">前提依赖</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#安装Helm3"><span class="nav-number">2.</span> <span class="nav-text">安装Helm3</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#配置helm的自动补全"><span class="nav-number">2.1.</span> <span class="nav-text">配置helm的自动补全</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#查看默认helm的环境变量"><span class="nav-number">2.2.</span> <span class="nav-text">查看默认helm的环境变量</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#查看配置helm-repo"><span class="nav-number">2.3.</span> <span class="nav-text">查看配置helm repo</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#使用Helm3-安装nginx-ingress"><span class="nav-number">3.</span> <span class="nav-text">使用Helm3 安装nginx-ingress</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#测试nginx-ingress"><span class="nav-number">3.1.</span> <span class="nav-text">测试nginx-ingress</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#创建nginx-deploy："><span class="nav-number">3.1.1.</span> <span class="nav-text">创建nginx deploy：</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#创建nginx-service"><span class="nav-number">3.1.2.</span> <span class="nav-text">创建nginx service:</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#创建nginx-ingress-规则"><span class="nav-number">3.1.3.</span> <span class="nav-text">创建nginx ingress 规则</span></a></li></ol></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <img class="site-author-image" itemprop="image" alt="Knner.Wang"
    src="/images/avatar.png">
  <p class="site-author-name" itemprop="name">Knner.Wang</p>
  <div class="site-description" itemprop="description">Knner.Wang's Blog,for sharing IT technology and also my study notes.</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">25</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
        <span class="site-state-item-count">22</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">20</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/wanghkkk" title="GitHub &amp;rarr; https:&#x2F;&#x2F;github.com&#x2F;wanghkkk" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://hub.docker.com/u/wanghkkk" title="DockerHub &amp;rarr; https:&#x2F;&#x2F;hub.docker.com&#x2F;u&#x2F;wanghkkk" rel="noopener" target="_blank"><i class="fa fa-fw fa-docker"></i>DockerHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:wanghk@live.cn" title="E-Mail &amp;rarr; mailto:wanghk@live.cn" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i>E-Mail</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        
  <div class="beian"><a href="https://beian.miit.gov.cn/" rel="noopener" target="_blank">京ICP备19058691号-1 </a>
      <img src="/images/knner/ga-icon.png" style="display: inline-block;"><a href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=11010802030660" rel="noopener" target="_blank">11010802030660 </a>
  </div>

<div class="copyright">
  
  &copy; 2018 – 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Knner.Wang 版权所有</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> 强力驱动 v4.0.0
    和<a href="https://www.upyun.com/?utm_source=lianmeng&utm_medium=referral" target="_blank" rel="noopener"><img width="60" style="display: inline;" src="/images/logos/upyun_logo5.png"></a>提供CDN加速/云存储服务
  </div>
  <span class="post-meta-divider">|</span>
  <div class="theme-info">主题 – <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> v7.5.0
  </div>

        












        
      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>
<script src="/js/utils.js"></script><script src="/js/motion.js"></script>
<script src="/js/schemes/pisces.js"></script>
<script src="/js/next-boot.js"></script><script src="/js/bookmark.js"></script>



  











<script>
if (document.querySelectorAll('div.pdf').length) {
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/pdfobject@2/pdfobject.min.js', () => {
    document.querySelectorAll('div.pdf').forEach(element => {
      PDFObject.embed(element.getAttribute('target'), element, {
        pdfOpenParams: {
          navpanes: 0,
          toolbar: 0,
          statusbar: 0,
          pagemode: 'thumbs',
          view: 'FitH'
        },
        PDFJS_URL: '/lib/pdf/web/viewer.html',
        height: element.getAttribute('height') || '500px'
      });
    });
  }, window.PDFObject);
}
</script>


<script>
if (document.querySelectorAll('pre.mermaid').length) {
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/mermaid@8/dist/mermaid.min.js', () => {
    mermaid.initialize({
      theme: 'forest',
      logLevel: 3,
      flowchart: { curve: 'linear' },
      gantt: { axisFormat: '%m/%d/%Y' },
      sequence: { actorMargin: 50 }
    });
  }, window.mermaid);
}
</script>



  

  

<script>
  function loadCount() {
    var d = document, s = d.createElement('script');
    s.src = 'https://knner.disqus.com/count.js';
    s.id = 'dsq-count-scr';
    (d.head || d.body).appendChild(s);
  }
  // defer loading until the whole page loading is completed
  window.addEventListener('load', loadCount, false);
</script>
<script>
  function loadComments() {
    if (window.DISQUS) {
      DISQUS.reset({
        reload: true,
        config: {page: {
            url: "https://knner.wang/2019/11/14/Pre-trial-helm3.html",
            identifier: "2019/11/14/Pre-trial-helm3.html",
            title: "抢先试用Helm3，并安装nginx-ingress-controller"
          }
        }
      });
    } else {
      var d = document, s = d.createElement('script');
      s.src = 'https://knner.disqus.com/embed.js';
      s.setAttribute('data-timestamp', '' + +new Date());
      (d.head || d.body).appendChild(s);
    }
  }
    (function() {
      var offsetTop = document.getElementById('comments').offsetTop - window.innerHeight;
      if (offsetTop <= 0) {
        // load directly when there's no a scrollbar
        window.addEventListener('load', loadComments, false);
      } else {
        var disqus_scroll = () => {
          // offsetTop may changes because of manually resizing browser window or lazy loading images.
          var offsetTop = document.getElementById('comments').offsetTop - window.innerHeight;
          var scrollTop = window.scrollY;

          // pre-load comments a bit? (margin or anything else)
          if (offsetTop - scrollTop < 60) {
            window.removeEventListener('scroll', disqus_scroll);
            loadComments();
          }
        };
        window.addEventListener('scroll', disqus_scroll);
      }
    })();
  
</script>

</body>
</html>
